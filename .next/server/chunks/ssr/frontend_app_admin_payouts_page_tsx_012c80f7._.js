module.exports=[60121,a=>{"use strict";var b=a.i(57850),c=a.i(45056),d=a.i(59843),e=a.i(70579),f=a.i(21900),g=a.i(74155),h=a.i(89698);let i=(0,a.i(31261).default)("receipt",[["path",{d:"M4 2v20l2-1 2 1 2-1 2 1 2-1 2 1 2-1 2 1V2l-2 1-2-1-2 1-2-1-2 1-2-1-2 1Z",key:"q3az6g"}],["path",{d:"M16 8h-6a2 2 0 1 0 0 4h4a2 2 0 1 1 0 4H8",key:"1h4pet"}],["path",{d:"M12 17.5v-11",key:"1jc1ny"}]]);var j=a.i(22663),k=a.i(40360),l=a.i(34376),m=a.i(37897),n=a.i(35971),o=a.i(97763),p=a.i(94674),q=a.i(92522),r=a.i(13916),s=a.i(52485);a.i(59888);var t=a.i(98534),u=a.i(47940);function v(){return(0,b.jsx)(u.ClientErrorBoundary,{children:(0,b.jsx)(w,{})})}function w(){let{user:a}=(0,n.useAuth)(),[u,v]=(0,c.useState)([]),[w,x]=(0,c.useState)(0),[y,z]=(0,c.useState)(!0),[A,B]=(0,c.useState)(null),[C,D]=(0,c.useState)(1),[E,F]=(0,c.useState)(1),[G,H]=(0,c.useState)(!1),[I,J]=(0,c.useState)(null),[K,L]=(0,c.useState)(""),[M,N]=(0,c.useState)(new Set);(0,c.useEffect)(()=>{O()},[C]);let O=async()=>{try{z(!0);let a=(await o.ordersAPI.getPayoutLedger({page:C,limit:20})).data;v(a.sellerGroups),x(a.pendingPayoutTotal);let b=a.totalSellers;F(Math.ceil(b/20))}catch(a){console.error("Failed to fetch payout ledger:",a),t.toast.error("Failed to load payout ledger.")}finally{z(!1)}},P=async a=>{try{B(a),await o.ordersAPI.markSellerPaidBatch(a,K?{notes:K}:void 0);let b=u.filter(b=>b.seller._id!==a);v(b);let c=u.find(b=>b.seller._id===a);c&&x(a=>a-c.pendingAmount),H(!1),L(""),J(null)}catch(a){console.error("Failed to mark as paid:",a),t.toast.error("Failed to mark as paid."),t.toast.error("Failed to mark as paid. Please try again.")}finally{B(null)}};return y?(0,b.jsxs)("div",{className:"container mx-auto px-4 py-8",children:[(0,b.jsx)(s.PageHeaderSkeleton,{showSubtitle:!0,showActions:!1}),(0,b.jsx)("div",{className:"mb-8 rounded-lg border bg-card p-6",children:(0,b.jsxs)("div",{className:"space-y-4",children:[(0,b.jsx)("div",{className:"h-6 bg-muted rounded w-48 animate-pulse"}),(0,b.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)("div",{className:"h-4 bg-muted rounded w-24 animate-pulse"}),(0,b.jsx)("div",{className:"h-8 bg-muted rounded w-32 animate-pulse"})]}),(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)("div",{className:"h-4 bg-muted rounded w-24 animate-pulse"}),(0,b.jsx)("div",{className:"h-8 bg-muted rounded w-32 animate-pulse"})]}),(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)("div",{className:"h-4 bg-muted rounded w-24 animate-pulse"}),(0,b.jsx)("div",{className:"h-8 bg-muted rounded w-32 animate-pulse"})]})]})]})}),(0,b.jsx)("div",{className:"space-y-4",children:[1,2,3,4,5].map(a=>(0,b.jsxs)("div",{className:"rounded-lg border bg-card p-6",children:[(0,b.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,b.jsxs)("div",{className:"flex items-center gap-4",children:[(0,b.jsx)("div",{className:"h-12 w-12 bg-muted rounded-full animate-pulse"}),(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)("div",{className:"h-4 bg-muted rounded w-48 animate-pulse"}),(0,b.jsx)("div",{className:"h-3 bg-muted rounded w-32 animate-pulse"})]})]}),(0,b.jsx)("div",{className:"h-6 bg-muted rounded w-24 animate-pulse"})]}),(0,b.jsx)("div",{className:"h-24 bg-muted rounded animate-pulse"})]},a))})]}):(0,b.jsxs)("div",{className:"container mx-auto px-4 py-8",children:[(0,b.jsxs)("div",{className:"mb-8",children:[(0,b.jsxs)(d.default,{href:"/admin",className:"inline-flex items-center text-muted-foreground hover:text-foreground mb-4",children:[(0,b.jsx)(f.ArrowLeft,{className:"h-4 w-4 mr-2"}),"Back to Dashboard"]}),(0,b.jsx)("h1",{className:"text-3xl font-bold",children:"Seller Payout Ledger"}),(0,b.jsx)("p",{className:"text-muted-foreground",children:"Manage payouts to sellers for completed orders"})]}),(0,b.jsxs)(p.Card,{className:"mb-8",children:[(0,b.jsx)(p.CardHeader,{children:(0,b.jsx)(p.CardTitle,{className:"text-lg",children:"Pending Payouts Summary"})}),(0,b.jsx)(p.CardContent,{children:(0,b.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)("p",{className:"text-sm text-muted-foreground",children:"Total Sellers to Pay"}),(0,b.jsx)("p",{className:"text-3xl font-bold",children:u.length})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("p",{className:"text-sm text-muted-foreground",children:"Total Orders to Pay"}),(0,b.jsx)("p",{className:"text-3xl font-bold",children:u.reduce((a,b)=>a+b.orders.length,0)})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("p",{className:"text-sm text-muted-foreground",children:"Total Amount to Pay"}),(0,b.jsx)("p",{className:"text-3xl font-bold text-green-600",children:(0,r.formatPrice)(w)})]})]})})]}),(0,b.jsx)("div",{className:"space-y-4",children:0===u.length?(0,b.jsx)(p.Card,{children:(0,b.jsx)(p.CardContent,{className:"py-12",children:(0,b.jsxs)("div",{className:"text-center",children:[(0,b.jsx)(g.Check,{className:"h-16 w-16 mx-auto text-green-500 mb-4"}),(0,b.jsx)("h3",{className:"text-lg font-semibold mb-2",children:"All Caught Up!"}),(0,b.jsx)("p",{className:"text-muted-foreground",children:"No pending payouts at the moment."})]})})}):u.map(a=>{let c=M.has(a.seller._id);return(0,b.jsxs)(p.Card,{children:[(0,b.jsx)(p.CardHeader,{className:"cursor-pointer hover:bg-muted/50 transition-colors",children:(0,b.jsxs)("div",{className:"flex items-center justify-between",children:[(0,b.jsxs)("div",{className:"flex items-center space-x-4 flex-1",children:[c?(0,b.jsx)(l.ChevronDown,{className:"h-5 w-5 text-muted-foreground"}):(0,b.jsx)(m.ChevronRight,{className:"h-5 w-5 text-muted-foreground"}),(0,b.jsxs)("div",{className:"flex-1",children:[(0,b.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,b.jsx)("h3",{className:"text-lg font-semibold",children:a.seller?.name||"Unknown"}),(0,b.jsxs)("span",{className:"px-2 py-1 rounded-full bg-blue-100 dark:bg-blue-900 text-blue-700 dark:text-blue-300 text-xs font-medium",children:[a.orders.length," order(s)"]})]}),(0,b.jsx)("p",{className:"text-sm text-muted-foreground",children:a.seller.email})]})]}),(0,b.jsxs)("div",{className:"flex items-center space-x-4",children:[(0,b.jsxs)("div",{className:"text-right",children:[(0,b.jsx)("p",{className:"text-sm text-muted-foreground",children:"Total Payout"}),(0,b.jsx)("p",{className:"text-2xl font-bold text-green-600",children:(0,r.formatPrice)(a.pendingAmount)})]}),(0,b.jsx)(q.default,{onClick:b=>{b.stopPropagation(),J(a),L(""),H(!0)},disabled:A===a.seller._id,size:"sm",className:"bg-green-600 hover:bg-green-700",children:A===a.seller._id?"Processing...":(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)(g.Check,{className:"h-4 w-4 mr-2"}),"Pay All"]})})]})]})}),c&&(0,b.jsx)(p.CardContent,{children:(0,b.jsxs)("div",{className:"border-t pt-4",children:[(0,b.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,b.jsxs)("h4",{className:"font-semibold text-sm text-muted-foreground",children:["Order Details (",a.orders.length,")"]}),(0,b.jsxs)("div",{className:"flex items-center space-x-2 text-sm",children:[(0,b.jsx)(h.Phone,{className:"h-4 w-4 text-muted-foreground"}),(0,b.jsx)("span",{className:"font-mono",children:a.seller.phone})]})]}),(0,b.jsx)("div",{className:"overflow-x-auto",children:(0,b.jsxs)("table",{className:"w-full",children:[(0,b.jsx)("thead",{children:(0,b.jsxs)("tr",{className:"border-b",children:[(0,b.jsx)("th",{className:"text-left py-2 px-3 font-medium text-sm",children:"Order"}),(0,b.jsx)("th",{className:"text-left py-2 px-3 font-medium text-sm",children:"Product"}),(0,b.jsx)("th",{className:"text-left py-2 px-3 font-medium text-sm",children:"Buyer"}),(0,b.jsx)("th",{className:"text-left py-2 px-3 font-medium text-sm",children:"M-Pesa Receipt"}),(0,b.jsx)("th",{className:"text-left py-2 px-3 font-medium text-sm",children:"Amount"}),(0,b.jsx)("th",{className:"text-left py-2 px-3 font-medium text-sm",children:"Date"})]})}),(0,b.jsx)("tbody",{children:a.orders.map(a=>(0,b.jsxs)("tr",{className:"border-b hover:bg-muted/30",children:[(0,b.jsxs)("td",{className:"py-3 px-3",children:[(0,b.jsx)("div",{className:"font-medium text-sm",children:a.orderNumber}),(0,b.jsxs)("div",{className:"text-xs text-muted-foreground",children:["ID: ",a.orderId.slice(-6)]})]}),(0,b.jsx)("td",{className:"py-3 px-3",children:(0,b.jsxs)("div",{className:"flex items-center space-x-2",children:[a.product.images?.[0]&&(0,b.jsx)("div",{className:"relative w-8 h-8 rounded overflow-hidden flex-shrink-0",children:(0,b.jsx)(e.default,{src:a.product.images[0],alt:a.product.title,fill:!0,className:"object-cover",sizes:"32px"})}),(0,b.jsxs)("div",{className:"max-w-xs",children:[(0,b.jsx)("div",{className:"text-sm font-medium truncate",children:a.product.title}),(0,b.jsxs)("div",{className:"text-xs text-muted-foreground",children:[a.product.condition," â€¢ ",(0,r.formatPrice)(a.product.price)]})]})]})}),(0,b.jsx)("td",{className:"py-3 px-3",children:(0,b.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,b.jsx)(j.User,{className:"h-3 w-3 text-muted-foreground"}),(0,b.jsxs)("div",{children:[(0,b.jsx)("div",{className:"text-sm font-medium",children:a.buyer.name}),(0,b.jsx)("div",{className:"text-xs text-muted-foreground",children:a.buyer.email})]})]})}),(0,b.jsx)("td",{className:"py-3 px-3",children:"mpesaTransactionId"in a&&a.mpesaTransactionId?(0,b.jsxs)("div",{className:"flex items-center space-x-1",children:[(0,b.jsx)(i,{className:"h-3 w-3 text-green-600"}),(0,b.jsx)("span",{className:"font-mono text-xs",children:a.mpesaTransactionId})]}):(0,b.jsx)("span",{className:"text-muted-foreground text-xs",children:"N/A"})}),(0,b.jsx)("td",{className:"py-3 px-3",children:(0,b.jsx)("div",{className:"font-semibold",children:(0,r.formatPrice)(a.totalPrice)})}),(0,b.jsx)("td",{className:"py-3 px-3",children:(0,b.jsxs)("div",{className:"flex items-center space-x-1 text-sm text-muted-foreground",children:[(0,b.jsx)(k.Calendar,{className:"h-3 w-3"}),(0,b.jsx)("span",{children:new Date(a.orderDate).toLocaleDateString("en-GB",{day:"numeric",month:"short",year:"numeric"})})]})})]},a.orderId))})]})})]})})]},a.seller._id)})}),E>1&&(0,b.jsxs)("div",{className:"flex justify-center items-center space-x-2 mt-6",children:[(0,b.jsx)(q.default,{onClick:()=>D(a=>Math.max(1,a-1)),disabled:1===C,variant:"outline",size:"sm",children:"Previous"}),(0,b.jsxs)("span",{className:"text-sm",children:["Page ",C," of ",E]}),(0,b.jsx)(q.default,{onClick:()=>D(a=>Math.min(E,a+1)),disabled:C===E,variant:"outline",size:"sm",children:"Next"})]}),G&&I&&(0,b.jsx)("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50",children:(0,b.jsxs)("div",{className:"bg-background rounded-lg p-6 max-w-md w-full mx-4",children:[(0,b.jsxs)("h3",{className:"text-lg font-semibold mb-4",children:["Confirm Payment to ",I.seller?.name||"Unknown"]}),(0,b.jsxs)("div",{className:"space-y-4 mb-6",children:[(0,b.jsxs)("div",{className:"bg-muted p-4 rounded-lg",children:[(0,b.jsxs)("div",{className:"flex justify-between mb-2",children:[(0,b.jsx)("span",{className:"text-sm text-muted-foreground",children:"Total Amount:"}),(0,b.jsx)("span",{className:"font-bold text-green-600",children:(0,r.formatPrice)(I.pendingAmount)})]}),(0,b.jsxs)("div",{className:"flex justify-between mb-2",children:[(0,b.jsx)("span",{className:"text-sm text-muted-foreground",children:"Orders:"}),(0,b.jsx)("span",{children:I.orders.length})]}),(0,b.jsxs)("div",{className:"flex justify-between",children:[(0,b.jsx)("span",{className:"text-sm text-muted-foreground",children:"To:"}),(0,b.jsx)("span",{className:"font-mono",children:I.seller.phone})]})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("label",{className:"block text-sm font-medium mb-2",children:"Notes (optional)"}),(0,b.jsx)("textarea",{value:K,onChange:a=>L(a.target.value),placeholder:"Add any notes about this payout...",className:"w-full border rounded-lg px-3 py-2 min-h-[80px] focus:outline-none focus:ring-2 focus:ring-primary"})]})]}),(0,b.jsxs)("div",{className:"flex justify-end space-x-3",children:[(0,b.jsx)(q.default,{onClick:()=>{H(!1),L(""),J(null)},variant:"outline",children:"Cancel"}),(0,b.jsx)(q.default,{onClick:()=>P(I.seller._id),disabled:A===I.seller._id,className:"bg-green-600 hover:bg-green-700",children:A===I.seller._id?"Processing...":"Confirm Paid"})]})]})})]})}a.s(["default",()=>v],60121)}];

//# sourceMappingURL=frontend_app_admin_payouts_page_tsx_012c80f7._.js.map