module.exports=[47940,a=>{"use strict";var b=a.i(57850),c=a.i(45056),d=a.i(32722);class e extends c.Component{constructor(a){super(a),this.state={hasError:!1,error:null}}static getDerivedStateFromError(a){return{hasError:!0,error:a}}componentDidCatch(a,b){console.error("ClientErrorBoundary caught an error:",a,b)}resetError=()=>{this.setState({hasError:!1,error:null})};render(){if(this.state.hasError){let a=this.props.fallback||d.ErrorFallback;return(0,b.jsx)(a,{error:this.state.error,resetError:this.resetError})}return this.props.children}}a.s(["ClientErrorBoundary",()=>e])},63062,a=>{"use strict";let b=(0,a.i(31261).default)("map-pin",[["path",{d:"M20 10c0 4.993-5.539 10.193-7.399 11.799a1 1 0 0 1-1.202 0C9.539 20.193 4 14.993 4 10a8 8 0 0 1 16 0",key:"1r0f0z"}],["circle",{cx:"12",cy:"10",r:"3",key:"ilqhr7"}]]);a.s(["MapPin",()=>b],63062)},97929,a=>{"use strict";var b=a.i(57850),c=a.i(45056),d=a.i(93609),e=a.i(70579),f=a.i(69355),g=a.i(63062),h=a.i(72084),i=a.i(97763),j=a.i(35971),k=a.i(47940);a.i(59888);var l=a.i(98534),m=a.i(13916);function n(){return(0,b.jsx)(k.ClientErrorBoundary,{children:(0,b.jsx)(o,{})})}function o(){let a=(0,d.useRouter)(),k=(0,d.useSearchParams)(),{isAuthenticated:n}=(0,j.useAuth)(),o=k.get("productId"),p=parseInt(k.get("quantity")||"1"),[q,r]=(0,c.useState)(null),[s,t]=(0,c.useState)(!0),[u,v]=(0,c.useState)(!1),[w,x]=(0,c.useState)(""),[y,z]=(0,c.useState)({street:"",building:"",room:""});(0,c.useEffect)(()=>{n?o?(async()=>{try{let a=await h.productsAPI.getProduct(o);r(a.data.product)}catch(b){console.error("Failed to fetch product:",b),l.toast.error("Failed to load product."),a.push("/products")}finally{t(!1)}})():a.push("/products"):a.push("/login")},[o,n,a]);let A=(0,c.useCallback)(async()=>{if(q){if(!w||w.length<10)return void l.toast.error("Please enter a valid phone number for M-Pesa payment");if(!y.street||!y.building||!y.room)return void l.toast.error("Please fill in all shipping address fields");v(!0);try{let b=(await i.ordersAPI.createOrder({productId:q._id,quantity:p,paymentMethod:"mpesa",shippingAddress:y})).data.order,c=await i.ordersAPI.initiatePayment(b._id,{phoneNumber:w});l.toast.success(`Payment initiated! Please check your phone for the M-Pesa prompt. Checkout Request ID: ${c.data.checkoutRequestID}`),a.push(`/buyer/orders/${b._id}`)}catch(a){l.toast.error(a.response?.data?.message||"Failed to place order. Please try again.")}finally{v(!1)}}},[q,w,y,p,a]);if(s)return(0,b.jsx)("div",{className:"container mx-auto px-4 py-16",children:(0,b.jsxs)("div",{className:"max-w-2xl mx-auto text-center",children:[(0,b.jsx)(f.Loader2,{className:"h-12 w-12 animate-spin mx-auto mb-4 text-primary"}),(0,b.jsx)("p",{className:"text-muted-foreground",children:"Loading checkout..."})]})});if(!q)return null;let B=q.price*p;return(0,b.jsx)("div",{className:"container mx-auto px-4 py-8",children:(0,b.jsxs)("div",{className:"max-w-2xl mx-auto",children:[(0,b.jsx)("h1",{className:"text-3xl font-bold mb-8",children:"Checkout"}),(0,b.jsxs)("div",{className:"space-y-6",children:[(0,b.jsxs)("div",{className:"rounded-lg border bg-card p-6",children:[(0,b.jsx)("h2",{className:"text-xl font-semibold mb-4",children:"Order Summary"}),(0,b.jsxs)("div",{className:"flex gap-4",children:[(0,b.jsx)("div",{className:"relative w-24 h-24 rounded-lg overflow-hidden bg-muted flex-shrink-0",children:q.images?.[0]?(0,b.jsx)(e.default,{src:q.images[0],alt:q.title,fill:!0,className:"object-cover"}):(0,b.jsx)("div",{className:"w-full h-full flex items-center justify-center text-muted-foreground",children:"No Image"})}),(0,b.jsxs)("div",{className:"flex-1",children:[(0,b.jsx)("h3",{className:"font-semibold",children:q.title}),(0,b.jsxs)("p",{className:"text-sm text-muted-foreground",children:["Seller: ",q.seller?.name]}),(0,b.jsxs)("p",{className:"text-sm text-muted-foreground",children:["Quantity: ",p]})]})]})]}),(0,b.jsxs)("div",{className:"rounded-lg border bg-card p-6",children:[(0,b.jsxs)("div",{className:"flex items-center space-x-2 mb-4",children:[(0,b.jsx)(g.MapPin,{className:"h-5 w-5 text-primary"}),(0,b.jsx)("h2",{className:"text-xl font-semibold",children:"Shipping Address"})]}),(0,b.jsxs)("div",{className:"space-y-4",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)("label",{className:"block text-sm font-medium mb-2",children:"Street/Hall Name *"}),(0,b.jsx)("input",{type:"text",value:y.street,onChange:a=>z({...y,street:a.target.value}),placeholder:"e.g., Main Street, Hostel A",className:"w-full px-4 py-2 rounded-lg border bg-background"})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("label",{className:"block text-sm font-medium mb-2",children:"Building/Floor *"}),(0,b.jsx)("input",{type:"text",value:y.building,onChange:a=>z({...y,building:a.target.value}),placeholder:"e.g., Building 1, 2nd Floor",className:"w-full px-4 py-2 rounded-lg border bg-background"})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("label",{className:"block text-sm font-medium mb-2",children:"Room Number *"}),(0,b.jsx)("input",{type:"text",value:y.room,onChange:a=>z({...y,room:a.target.value}),placeholder:"e.g., Room 123, 2B",className:"w-full px-4 py-2 rounded-lg border bg-background"})]})]})]}),(0,b.jsxs)("div",{className:"rounded-lg border bg-card p-6",children:[(0,b.jsx)("h2",{className:"text-xl font-semibold mb-4",children:"Payment Details"}),(0,b.jsxs)("div",{className:"space-y-4",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)("label",{className:"block text-sm font-medium mb-2",children:"M-Pesa Phone Number"}),(0,b.jsx)("input",{type:"tel",placeholder:"e.g., 0712345678",value:w,onChange:a=>x(a.target.value),className:"w-full px-4 py-2 rounded-lg border bg-background"}),(0,b.jsx)("p",{className:"text-xs text-muted-foreground mt-1",children:"You will receive an M-Pesa prompt on this number"})]}),(0,b.jsxs)("div",{className:"pt-4 border-t space-y-2",children:[(0,b.jsxs)("div",{className:"flex justify-between",children:[(0,b.jsx)("span",{className:"text-muted-foreground",children:"Subtotal"}),(0,b.jsx)("span",{children:(0,m.formatPrice)(q.price)})]}),(0,b.jsxs)("div",{className:"flex justify-between",children:[(0,b.jsx)("span",{className:"text-muted-foreground",children:"Quantity"}),(0,b.jsxs)("span",{children:["x",p]})]}),(0,b.jsx)("div",{className:"h-px bg-border my-2"}),(0,b.jsxs)("div",{className:"flex justify-between text-lg font-semibold",children:[(0,b.jsx)("span",{children:"Total"}),(0,b.jsx)("span",{className:"text-primary",children:(0,m.formatPrice)(B)})]})]})]})]}),(0,b.jsx)("button",{onClick:A,disabled:u,className:"w-full px-6 py-4 bg-primary text-primary-foreground rounded-lg hover:bg-primary/90 transition-colors font-semibold text-lg disabled:opacity-50 disabled:cursor-not-allowed",children:u?(0,b.jsxs)("span",{className:"flex items-center justify-center space-x-2",children:[(0,b.jsx)(f.Loader2,{className:"h-5 w-5 animate-spin"}),(0,b.jsx)("span",{children:"Processing..."})]}):`Place Order - ${(0,m.formatPrice)(B)}`}),(0,b.jsx)("p",{className:"text-center text-sm text-muted-foreground",children:"By placing this order, you agree to our terms and conditions"})]})]})})}a.s(["default",()=>n])}];

//# sourceMappingURL=frontend_4b8f52a4._.js.map