module.exports=[71224,a=>{"use strict";var b=a.i(57850),c=a.i(45056),d=a.i(84588);function e(){let[a,e]=(0,c.useState)("testbuyer@example.com"),[f,g]=(0,c.useState)("Test@Password123"),[h,i]=(0,c.useState)([]),[j,k]=(0,c.useState)(!1),l=(a,b,c,d)=>{i(e=>[...e,{name:a,status:b,message:c,duration:d}])},m=()=>{i([])},n=async(a,b)=>{let c=performance.now();try{await b();let d=performance.now()-c;l(a,"success","Test passed",d)}catch(d){let b=performance.now()-c;l(a,"error",d.response?.data?.message||d.message||"Test failed",b)}},o=async()=>{let b=await d.authAPI.login({email:a,password:f});if(b.data.success&&b.data.token)return localStorage.setItem("token",b.data.token),localStorage.setItem("user",JSON.stringify(b.data.user)),b.data.token;throw Error("Login failed - no token received")},p=async()=>{let a=localStorage.getItem("token");if(!a)throw Error("No token found in localStorage");let b=await d.authAPI.refreshToken(a);if(b.data.success&&b.data.token){let a=b.data.token;if(localStorage.setItem("token",a),!(await d.authAPI.getMe()).data.success)throw Error("New token does not work");return a}throw Error("Token refresh failed - no new token received")},q=async()=>{try{throw await d.authAPI.refreshToken("invalid.token.here"),Error("Should have failed with invalid token")}catch(a){if(a.response?.status===401)return;throw a}},r=async()=>{try{throw await d.authAPI.refreshToken(null),Error("Should have failed with null token")}catch(a){if(a.response?.status===400||a.response?.status===401)return;throw a}},s=async()=>{m(),k(!0),await n("1. User Login",async()=>{await o()}),await n("2. Verify Current Token",async()=>{if(!(await d.authAPI.getMe()).data.success)throw Error("Could not verify current token")}),await n("3. Token Refresh",async()=>{await p()}),await n("4. Verify Refreshed Token",async()=>{if(!(await d.authAPI.getMe()).data.success)throw Error("Could not verify refreshed token")}),await n("5. Refresh with Invalid Token",async()=>{await q()}),await n("6. Refresh with Malformed Token",async()=>{await r()}),await n("7. Token Structure Check",async()=>{let a=localStorage.getItem("token");if(!a)throw Error("No token found");let b=a.split(".");if(3!==b.length)throw Error("Invalid JWT structure");let c=JSON.parse(atob(b[1]));if(!c.id||!c.iat||!c.exp)throw Error("Token missing required claims");let d=new Date(1e3*c.exp),e=new Date,f=Math.floor((d.getTime()-e.getTime())/1e3/60);if(f<0)throw Error("Token has expired");console.log("Token payload:",c),console.log("Time to expiry:",f,"minutes")}),k(!1)},t=async()=>{m(),k(!0);try{l("1. Initial Login","pending","Logging in...");let a=await o();l("1. Initial Login","success",`Token received: ${a.substring(0,20)}...`),l("2. Simulate Token Expiration","pending","Corrupting token..."),a.substring(0,a.length-10),l("2. Simulate Token Expiration","success","Token corrupted"),l("3. Attempt API Call with Corrupted Token","pending","Testing auto-refresh...");try{localStorage.setItem("token",a),await d.authAPI.getMe(),l("3. Attempt API Call with Valid Token","success","API call successful")}catch(a){l("3. Attempt API Call with Corrupted Token","error","API call failed")}}catch(a){l("Simulation Error","error",a.message)}k(!1)};return(0,b.jsx)("div",{className:"min-h-screen bg-gray-50 py-12 px-4",children:(0,b.jsx)("div",{className:"max-w-4xl mx-auto",children:(0,b.jsxs)("div",{className:"bg-white rounded-lg shadow-md p-8",children:[(0,b.jsx)("h1",{className:"text-3xl font-bold text-gray-900 mb-2",children:"JWT Token Refresh Test"}),(0,b.jsx)("p",{className:"text-gray-600 mb-8",children:"This page tests the JWT token refresh mechanism implemented in the Campus Market frontend."}),(0,b.jsxs)("div",{className:"bg-gray-50 rounded-lg p-6 mb-6",children:[(0,b.jsx)("h2",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Test Configuration"}),(0,b.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)("label",{htmlFor:"email",className:"block text-sm font-medium text-gray-700 mb-1",children:"Email"}),(0,b.jsx)("input",{id:"email",type:"email",value:a,onChange:a=>e(a.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"test@example.com"})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("label",{htmlFor:"password",className:"block text-sm font-medium text-gray-700 mb-1",children:"Password"}),(0,b.jsx)("input",{id:"password",type:"password",value:f,onChange:a=>g(a.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"••••••••"})]})]})]}),(0,b.jsxs)("div",{className:"flex flex-wrap gap-4 mb-6",children:[(0,b.jsx)("button",{onClick:s,disabled:j,className:"px-6 py-3 bg-blue-600 text-white rounded-lg hover:bg-blue-700 disabled:bg-gray-400 disabled:cursor-not-allowed font-medium",children:j?"Running Tests...":"Run All Tests"}),(0,b.jsx)("button",{onClick:t,disabled:j,className:"px-6 py-3 bg-purple-600 text-white rounded-lg hover:bg-purple-700 disabled:bg-gray-400 disabled:cursor-not-allowed font-medium",children:j?"Running...":"Test Expiration Simulation"}),(0,b.jsx)("button",{onClick:m,className:"px-6 py-3 bg-gray-600 text-white rounded-lg hover:bg-gray-700 font-medium",children:"Clear Results"})]}),h.length>0&&(0,b.jsxs)("div",{className:"border rounded-lg overflow-hidden",children:[(0,b.jsx)("div",{className:"bg-gray-50 px-6 py-4 border-b",children:(0,b.jsx)("h2",{className:"text-lg font-semibold text-gray-900",children:"Test Results"})}),(0,b.jsx)("div",{className:"divide-y",children:h.map((a,c)=>(0,b.jsxs)("div",{className:"px-6 py-4 flex items-start justify-between",children:[(0,b.jsxs)("div",{className:"flex-1",children:[(0,b.jsxs)("div",{className:"flex items-center gap-2 mb-1",children:["pending"===a.status&&(0,b.jsxs)("svg",{className:"w-5 h-5 text-yellow-500 animate-spin",fill:"none",viewBox:"0 0 24 24",children:[(0,b.jsx)("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),(0,b.jsx)("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),"success"===a.status&&(0,b.jsx)("svg",{className:"w-5 h-5 text-green-500",fill:"currentColor",viewBox:"0 0 20 20",children:(0,b.jsx)("path",{fillRule:"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z",clipRule:"evenodd"})}),"error"===a.status&&(0,b.jsx)("svg",{className:"w-5 h-5 text-red-500",fill:"currentColor",viewBox:"0 0 20 20",children:(0,b.jsx)("path",{fillRule:"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z",clipRule:"evenodd"})}),(0,b.jsx)("h3",{className:"font-medium text-gray-900",children:a.name})]}),(0,b.jsx)("p",{className:`text-sm ml-7 ${"error"===a.status?"text-red-600":"text-gray-600"}`,children:a.message})]}),void 0!==a.duration&&(0,b.jsxs)("span",{className:"text-sm text-gray-500 font-mono",children:[a.duration.toFixed(0),"ms"]})]},c))})]}),!1,(0,b.jsxs)("div",{className:"mt-6 bg-yellow-50 rounded-lg p-6",children:[(0,b.jsx)("h2",{className:"text-lg font-semibold text-gray-900 mb-4",children:"How the Token Refresh Works"}),(0,b.jsxs)("ol",{className:"list-decimal list-inside space-y-2 text-sm text-gray-700",children:[(0,b.jsx)("li",{children:"When a user logs in, they receive a JWT token valid for 7 days"}),(0,b.jsx)("li",{children:"Each API request includes this token in the Authorization header"}),(0,b.jsx)("li",{children:"If the token expires (401 response), the axios interceptor catches it"}),(0,b.jsx)("li",{children:"The interceptor calls the refresh endpoint with the old token"}),(0,b.jsx)("li",{children:"The backend validates the old token and issues a new token"}),(0,b.jsx)("li",{children:"The new token is stored in localStorage and the original request is retried"}),(0,b.jsx)("li",{children:"If refresh fails, the user is logged out and redirected to login page"}),(0,b.jsx)("li",{children:"Multiple simultaneous requests with expired tokens are queued and handled together"})]})]})]})})})}a.s(["default",()=>e])}];

//# sourceMappingURL=frontend_app_test-token-refresh_page_tsx_1728cbd0._.js.map