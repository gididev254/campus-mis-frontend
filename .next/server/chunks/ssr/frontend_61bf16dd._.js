module.exports=[92522,a=>{"use strict";var b=a.i(57850),c=a.i(13916);function d({children:a,className:d,variant:e="primary",size:f="md",isLoading:g=!1,loadingText:h,disabled:i,...j}){return(0,b.jsx)("button",{type:j.type||"button",className:(0,c.cn)("inline-flex items-center justify-center rounded-lg font-medium transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-offset-2 focus-visible:ring-ring disabled:opacity-50 disabled:pointer-events-none disabled:cursor-not-allowed",{primary:"bg-primary text-primary-foreground hover:opacity-90 focus-visible:ring-primary",secondary:"bg-secondary text-secondary-foreground hover:opacity-90 focus-visible:ring-secondary",outline:"border border-border hover:bg-accent hover:text-accent-foreground focus-visible:ring-border",ghost:"hover:bg-accent hover:text-accent-foreground focus-visible:ring-accent",danger:"bg-destructive text-destructive-foreground hover:opacity-90 focus-visible:ring-destructive"}[e],{sm:"px-3 py-1.5 text-sm",md:"px-4 py-2 text-base",lg:"px-6 py-3 text-lg"}[f],d),disabled:i||g,"aria-live":g?"polite":void 0,"aria-busy":g,...j,children:g?(0,b.jsxs)(b.Fragment,{children:[(0,b.jsxs)("svg",{className:"animate-spin -ml-1 mr-2 h-4 w-4",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","aria-hidden":"true",role:"img",children:[(0,b.jsx)("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),(0,b.jsx)("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),(0,b.jsx)("span",{children:h||"Loading..."})]}):a})}a.s(["default",()=>d])},47940,a=>{"use strict";var b=a.i(57850),c=a.i(45056),d=a.i(32722);class e extends c.Component{constructor(a){super(a),this.state={hasError:!1,error:null}}static getDerivedStateFromError(a){return{hasError:!0,error:a}}componentDidCatch(a,b){console.error("ClientErrorBoundary caught an error:",a,b)}resetError=()=>{this.setState({hasError:!1,error:null})};render(){if(this.state.hasError){let a=this.props.fallback||d.ErrorFallback;return(0,b.jsx)(a,{error:this.state.error,resetError:this.resetError})}return this.props.children}}a.s(["ClientErrorBoundary",()=>e])},18188,a=>{"use strict";var b=a.i(57850),c=a.i(45056),d=a.i(13916);function e({label:a,error:e,helperText:f,className:g,id:h,...i}){let j=c.default.useId(),k=h||j,l=e?`${k}-error`:void 0,m=f?`${k}-helper`:void 0,n=[l,m].filter(Boolean).join(" ")||void 0;return(0,b.jsxs)("div",{className:"w-full",children:[a&&(0,b.jsxs)("label",{htmlFor:k,className:"block text-sm font-medium mb-1.5 text-foreground",children:[a,i.required&&(0,b.jsx)("span",{className:"text-destructive ml-1","aria-label":"required",children:"*"})]}),(0,b.jsx)("input",{id:k,"aria-invalid":e?"true":"false","aria-describedby":n,"aria-required":i.required?"true":void 0,className:(0,d.cn)("w-full px-4 py-2.5 rounded-lg border border-input bg-background text-foreground","placeholder:text-muted-foreground","focus:outline-none focus:ring-2 focus:ring-ring focus:border-transparent focus-visible:ring-2 focus-visible:ring-offset-2","disabled:opacity-50 disabled:cursor-not-allowed",e&&"border-destructive focus:ring-destructive focus-visible:ring-destructive",g),...i}),e&&(0,b.jsx)("p",{id:l,className:"mt-1 text-sm text-destructive",role:"alert","aria-live":"assertive",children:e}),f&&!e&&(0,b.jsx)("p",{id:m,className:"mt-1 text-sm text-muted-foreground",children:f})]})}a.s(["default",()=>e])},21900,a=>{"use strict";let b=(0,a.i(31261).default)("arrow-left",[["path",{d:"m12 19-7-7 7-7",key:"1l729n"}],["path",{d:"M19 12H5",key:"x3x0zl"}]]);a.s(["ArrowLeft",()=>b],21900)},74155,a=>{"use strict";let b=(0,a.i(31261).default)("check",[["path",{d:"M20 6 9 17l-5-5",key:"1gmf2c"}]]);a.s(["Check",()=>b],74155)},46710,a=>{"use strict";var b=a.i(57850),c=a.i(70579),d=a.i(45056),e=a.i(13916),f=a.i(22663),g=a.i(62129);let h={sm:"w-8 h-8",md:"w-10 h-10",lg:"w-12 h-12",xl:"w-16 h-16"},i=(0,d.memo)(function({src:a,alt:i,size:j="md",className:k,priority:l=!1,showOnlineStatus:m=!1,isOnline:n=!1}){let[o,p]=(0,d.useState)(!1),{sizeClass:q,customSize:r}=(0,d.useMemo)(()=>({sizeClass:"number"==typeof j?"":h[j],customSize:"number"==typeof j?{width:j,height:j}:{}}),[j]),s=(0,d.useMemo)(()=>g.IMAGE_SIZES.avatar,[]),t=(0,d.useCallback)(()=>{p(!0)},[]),u=(0,d.useMemo)(()=>{let a=i.trim().split(" ");return a.length>=2?`${a[0][0]}${a[1][0]}`.toUpperCase():i[0].toUpperCase()},[i]),v=(0,d.useMemo)(()=>n?"bg-green-500":"bg-gray-400",[n]);return(0,b.jsxs)("div",{className:(0,e.cn)("relative rounded-full overflow-hidden bg-primary/10 flex items-center justify-center flex-shrink-0",q,k),style:r,children:[a&&!o?(0,b.jsx)(c.default,{src:a,alt:i,fill:!0,className:"object-cover",sizes:s,priority:l,placeholder:"blur",blurDataURL:g.DEFAULT_BLUR_DATA_URL,onError:t}):(0,b.jsx)("div",{className:"w-full h-full flex items-center justify-center text-primary font-semibold",children:u||(0,b.jsx)(f.User,{className:"h-1/2 w-1/2"})}),m&&(0,b.jsx)("span",{className:(0,e.cn)("absolute bottom-0 right-0 w-3 h-3 border-2 border-background rounded-full transition-colors",v),"aria-label":n?"Online":"Offline"})]})});a.s(["default",0,i])},29163,a=>{"use strict";let b=(0,a.i(31261).default)("circle",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}]]);a.s(["Circle",()=>b],29163)},47060,a=>{"use strict";var b=a.i(57850),c=a.i(45056),d=a.i(93609),e=a.i(59843),f=a.i(46710),g=a.i(69355);let h=(0,a.i(31261).default)("send",[["path",{d:"M14.536 21.686a.5.5 0 0 0 .937-.024l6.5-19a.496.496 0 0 0-.635-.635l-19 6.5a.5.5 0 0 0-.024.937l7.93 3.18a2 2 0 0 1 1.112 1.11z",key:"1ffxy3"}],["path",{d:"m21.854 2.147-10.94 10.939",key:"12cjpa"}]]);var i=a.i(21900),j=a.i(79373),k=a.i(74155),l=a.i(84812),m=a.i(29163),n=a.i(50568),o=a.i(35971),p=a.i(5596),q=a.i(92522),r=a.i(18188),s=a.i(47940);function t(){return(0,b.jsx)(s.ClientErrorBoundary,{children:(0,b.jsx)(u,{})})}function u(){let a=(0,d.useRouter)(),s=(0,d.useSearchParams)(),{user:t,isAuthenticated:u}=(0,o.useAuth)(),{socket:v,isConnected:w,onlineUsers:x,isReconnecting:y,emitWithQueue:z,queuedMessageCount:A}=(0,p.useSocket)(),B=s.get("userId"),C=(0,c.useRef)(null),D=(0,c.useRef)(null),[E,F]=(0,c.useState)([]),[G,H]=(0,c.useState)(!0),[I,J]=(0,c.useState)(!1),[K,L]=(0,c.useState)(""),[M,N]=(0,c.useState)(null),[O,P]=(0,c.useState)(""),[Q,R]=(0,c.useState)(!1),[S,T]=(0,c.useState)(!1),[U,V]=(0,c.useState)(!1);(0,c.useEffect)(()=>{u?B&&W():a.push("/login")},[u,B,a]),(0,c.useEffect)(()=>{C.current?.scrollIntoView({behavior:"smooth"})},[E]),(0,c.useEffect)(()=>{if(v&&w&&B&&t?._id)return[t._id,B].sort().join(":"),v.emit("join:conversation",{userId:B}),v.on("message:new",a=>{F(b=>b.some(b=>b._id===a._id)?b:[...b,a])}),v.on("typing:start",({userId:a})=>{a===B&&T(!0)}),v.on("typing:stop",({userId:a})=>{a===B&&T(!1)}),v.on("message:read",({messageId:a})=>{F(b=>b.map(b=>b._id===a?{...b,isRead:!0,readAt:new Date().toISOString()}:b))}),()=>{v.emit("leave:conversation",{userId:B}),v.off("message:new"),v.off("typing:start"),v.off("typing:stop"),v.off("message:read")}},[v,w,B,t?._id]);let W=(0,c.useCallback)(async()=>{try{let a=await n.messagesAPI.getConversation(B);if(F(a.data.data||[]),a.data.data.length>0){let b=a.data.data[0];N(b.sender._id===B?b.sender:b.receiver)}}catch(a){console.error("Failed to fetch messages:",a),toast.error("Failed to load messages."),P("Failed to load messages. Please try again.")}finally{H(!1)}},[B]),X=(0,c.useCallback)(()=>{v&&w&&B&&(z("typing:start",{userId:B}),D.current&&clearTimeout(D.current),D.current=setTimeout(()=>{w&&z("typing:stop",{userId:B})},2e3))},[v,w,B,z]),Y=(0,c.useCallback)(async a=>{if(a.preventDefault(),!K.trim())return;D.current&&clearTimeout(D.current),v&&w&&v.emit("typing:stop",{userId:B}),J(!0),P("");let b={_id:`temp-${Date.now()}`,sender:{_id:t?._id||"",name:t?.name||"",email:t?.email||"",role:t?.role||"buyer",phone:t?.phone||"",avatar:t?.avatar},receiver:{_id:B||"",name:M?.name||"",email:M?.email||"",role:M?.role||"seller",phone:M?.phone||"",avatar:M?.avatar},content:K,createdAt:new Date().toISOString(),isRead:!1};F(a=>[...a,b]),L("");try{await n.messagesAPI.sendMessage({receiver:B,content:K})}catch(a){F(a=>a.filter(a=>a._id!==b._id)),P(a instanceof Error&&"response"in a&&a.response?.data?.message||"Failed to send message"),L(K)}finally{J(!1)}},[K,t,M,B,v,w]),Z=M&&x.has(M._id);return G?(0,b.jsx)("div",{className:"container mx-auto px-4 py-8",children:(0,b.jsxs)("div",{className:"max-w-4xl mx-auto",children:[(0,b.jsx)("div",{className:"flex items-center justify-between mb-6",children:(0,b.jsxs)("div",{className:"flex items-center space-x-4",children:[(0,b.jsx)("div",{className:"w-10 h-10 bg-muted rounded-full animate-pulse"}),(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)("div",{className:"h-8 bg-muted rounded w-48 animate-pulse"}),(0,b.jsx)("div",{className:"h-4 bg-muted rounded w-32 animate-pulse"})]})]})}),(0,b.jsxs)("div",{className:"rounded-lg border bg-card p-6",children:[(0,b.jsx)("div",{className:"space-y-4 max-h-[60vh] overflow-y-auto",children:Array.from({length:5}).map((a,c)=>(0,b.jsxs)("div",{className:"flex gap-4",children:[(0,b.jsx)("div",{className:"w-12 h-12 rounded-full bg-muted animate-pulse flex-shrink-0"}),(0,b.jsxs)("div",{className:"flex-1 space-y-2",children:[(0,b.jsx)("div",{className:"h-4 bg-muted rounded w-3/4 animate-pulse"}),(0,b.jsx)("div",{className:"h-3 bg-muted rounded w-full animate-pulse"})]})]},c))}),(0,b.jsxs)("div",{className:"flex space-x-3 mt-6",children:[(0,b.jsx)("div",{className:"h-10 bg-muted rounded flex-1 animate-pulse"}),(0,b.jsx)("div",{className:"h-10 w-12 bg-muted rounded animate-pulse"})]})]})]})}):(0,b.jsx)("div",{className:"container mx-auto px-4 py-8",children:(0,b.jsxs)("div",{className:"max-w-4xl mx-auto",children:[(0,b.jsxs)("div",{className:"flex items-center justify-between mb-6",children:[(0,b.jsxs)("div",{className:"flex items-center space-x-4",children:[(0,b.jsx)(q.default,{variant:"ghost",onClick:()=>a.back(),className:"p-2","aria-label":"Go back",children:(0,b.jsx)(i.ArrowLeft,{className:"h-5 w-5"})}),(0,b.jsxs)("div",{className:"flex items-center space-x-3",children:[M&&(0,b.jsx)(f.default,{src:M.avatar,alt:M.name,size:"md",showOnlineStatus:!0,isOnline:Z}),(0,b.jsxs)("div",{children:[(0,b.jsxs)("h1",{className:"text-2xl font-bold flex items-center space-x-2",children:[(0,b.jsx)("span",{children:M?.name||"Messages"}),Z&&(0,b.jsxs)("span",{className:"text-sm font-normal text-green-500 flex items-center",children:[(0,b.jsx)(m.Circle,{className:"h-2 w-2 fill-current mr-1"}),"Online"]})]}),(0,b.jsx)("p",{className:"text-sm text-muted-foreground",children:S?(0,b.jsx)("span",{className:"text-primary animate-pulse",children:"Typing..."}):y?(0,b.jsx)("span",{className:"text-yellow-500 animate-pulse",children:"Reconnecting..."}):Z?"Active now":"Offline"})]})]})]}),(0,b.jsxs)("div",{className:"flex items-center space-x-2 text-sm text-muted-foreground",children:[(0,b.jsx)("div",{className:`w-2 h-2 rounded-full ${w?"bg-green-500":y?"bg-yellow-500 animate-pulse":"bg-red-500"}`}),(0,b.jsxs)("span",{children:[w?"Connected":y?"Reconnecting...":"Disconnected",A>0&&` (${A} queued)`]})]})]}),(0,b.jsxs)("div",{className:"rounded-lg border bg-card p-6",children:[O&&(0,b.jsxs)("div",{className:"mb-4 p-3 rounded-lg bg-destructive/10 text-destructive text-sm flex items-center space-x-2",children:[(0,b.jsx)(j.AlertCircle,{className:"h-4 w-4 flex-shrink-0"}),(0,b.jsx)("p",{children:O})]}),(0,b.jsxs)("div",{className:"space-y-4 mb-6 max-h-[60vh] overflow-y-auto",children:[0===E.length?(0,b.jsx)("div",{className:"text-center py-12 text-muted-foreground",children:"No messages yet. Start the conversation!"}):E.map(a=>{let c=a.sender._id===t?._id,d=a._id.startsWith("temp-");return(0,b.jsx)("div",{className:`flex ${c?"justify-end":"justify-start"}`,children:(0,b.jsxs)("div",{className:`max-w-[70%] ${c?"order-2":"order-1"}`,children:[(0,b.jsxs)("div",{className:`rounded-lg p-4 ${c?"bg-primary text-primary-foreground":"bg-muted"} ${d?"opacity-60":""}`,children:[(0,b.jsx)("p",{className:"text-sm whitespace-pre-wrap break-words",children:a.content}),a.product&&(0,b.jsx)(e.default,{href:`/products/${a.product._id}`,className:"text-xs underline opacity-80 hover:opacity-100 inline-block mt-2",children:"View Product"})]}),(0,b.jsxs)("div",{className:"flex items-center justify-end space-x-1 mt-1 px-2",children:[(0,b.jsx)("p",{className:"text-xs text-muted-foreground",children:new Date(a.createdAt).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})}),c&&(0,b.jsx)("span",{className:"text-xs",children:a.isRead?(0,b.jsx)(l.CheckCheck,{className:"h-3 w-3 text-blue-500 inline"}):(0,b.jsx)(k.Check,{className:"h-3 w-3 text-muted-foreground inline"})}),d&&(0,b.jsx)(g.Loader2,{className:"h-3 w-3 animate-spin text-muted-foreground"})]})]})},a._id)}),(0,b.jsx)("div",{ref:C})]}),(0,b.jsxs)("form",{onSubmit:Y,className:"flex space-x-3",children:[(0,b.jsx)(r.default,{type:"text",value:K,onChange:a=>{L(a.target.value),X()},placeholder:y?"Reconnecting to server...":A>0?`Sending ${A} queued message${A>1?"s":""}...`:"Type a message...",className:"flex-1",disabled:I||y}),(0,b.jsxs)(q.default,{type:"submit",disabled:I||!K.trim()||y,isLoading:I,className:"px-4",title:y?"Waiting for connection...":A>0?`${A} message${A>1?"s":""} in queue`:"Send message",children:[(0,b.jsx)(h,{className:"h-5 w-5"}),A>0&&(0,b.jsx)("span",{className:"ml-2 text-xs bg-yellow-500 text-white px-2 py-0.5 rounded-full",children:A})]})]})]})]})})}a.s(["default",()=>t],47060)}];

//# sourceMappingURL=frontend_61bf16dd._.js.map