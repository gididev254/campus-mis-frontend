module.exports=[92522,a=>{"use strict";var b=a.i(57850),c=a.i(13916);function d({children:a,className:d,variant:e="primary",size:f="md",isLoading:g=!1,loadingText:h,disabled:i,...j}){return(0,b.jsx)("button",{type:j.type||"button",className:(0,c.cn)("inline-flex items-center justify-center rounded-lg font-medium transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-offset-2 focus-visible:ring-ring disabled:opacity-50 disabled:pointer-events-none disabled:cursor-not-allowed",{primary:"bg-primary text-primary-foreground hover:opacity-90 focus-visible:ring-primary",secondary:"bg-secondary text-secondary-foreground hover:opacity-90 focus-visible:ring-secondary",outline:"border border-border hover:bg-accent hover:text-accent-foreground focus-visible:ring-border",ghost:"hover:bg-accent hover:text-accent-foreground focus-visible:ring-accent",danger:"bg-destructive text-destructive-foreground hover:opacity-90 focus-visible:ring-destructive"}[e],{sm:"px-3 py-1.5 text-sm",md:"px-4 py-2 text-base",lg:"px-6 py-3 text-lg"}[f],d),disabled:i||g,"aria-live":g?"polite":void 0,"aria-busy":g,...j,children:g?(0,b.jsxs)(b.Fragment,{children:[(0,b.jsxs)("svg",{className:"animate-spin -ml-1 mr-2 h-4 w-4",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","aria-hidden":"true",role:"img",children:[(0,b.jsx)("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),(0,b.jsx)("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),(0,b.jsx)("span",{children:h||"Loading..."})]}):a})}a.s(["default",()=>d])},26638,a=>{"use strict";let b=(0,a.i(31261).default)("message-circle",[["path",{d:"M2.992 16.342a2 2 0 0 1 .094 1.167l-1.065 3.29a1 1 0 0 0 1.236 1.168l3.413-.998a2 2 0 0 1 1.099.092 10 10 0 1 0-4.777-4.719",key:"1sd12s"}]]);a.s(["MessageCircle",()=>b],26638)},46710,a=>{"use strict";var b=a.i(57850),c=a.i(70579),d=a.i(45056),e=a.i(13916),f=a.i(22663),g=a.i(62129);let h={sm:"w-8 h-8",md:"w-10 h-10",lg:"w-12 h-12",xl:"w-16 h-16"},i=(0,d.memo)(function({src:a,alt:i,size:j="md",className:k,priority:l=!1,showOnlineStatus:m=!1,isOnline:n=!1}){let[o,p]=(0,d.useState)(!1),{sizeClass:q,customSize:r}=(0,d.useMemo)(()=>({sizeClass:"number"==typeof j?"":h[j],customSize:"number"==typeof j?{width:j,height:j}:{}}),[j]),s=(0,d.useMemo)(()=>g.IMAGE_SIZES.avatar,[]),t=(0,d.useCallback)(()=>{p(!0)},[]),u=(0,d.useMemo)(()=>{let a=i.trim().split(" ");return a.length>=2?`${a[0][0]}${a[1][0]}`.toUpperCase():i[0].toUpperCase()},[i]),v=(0,d.useMemo)(()=>n?"bg-green-500":"bg-gray-400",[n]);return(0,b.jsxs)("div",{className:(0,e.cn)("relative rounded-full overflow-hidden bg-primary/10 flex items-center justify-center flex-shrink-0",q,k),style:r,children:[a&&!o?(0,b.jsx)(c.default,{src:a,alt:i,fill:!0,className:"object-cover",sizes:s,priority:l,placeholder:"blur",blurDataURL:g.DEFAULT_BLUR_DATA_URL,onError:t}):(0,b.jsx)("div",{className:"w-full h-full flex items-center justify-center text-primary font-semibold",children:u||(0,b.jsx)(f.User,{className:"h-1/2 w-1/2"})}),m&&(0,b.jsx)("span",{className:(0,e.cn)("absolute bottom-0 right-0 w-3 h-3 border-2 border-background rounded-full transition-colors",v),"aria-label":n?"Online":"Offline"})]})});a.s(["default",0,i])},29163,a=>{"use strict";let b=(0,a.i(31261).default)("circle",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}]]);a.s(["Circle",()=>b],29163)},56846,a=>{"use strict";var b=a.i(57850),c=a.i(45056),d=a.i(93609),e=a.i(59843),f=a.i(26638),g=a.i(50568),h=a.i(35971),i=a.i(5596),j=a.i(92522),k=a.i(52485),l=a.i(46710),m=a.i(29163);let n=(0,c.memo)(function({conversation:a,isOnline:d}){let f=(0,c.useMemo)(()=>a.lastMessage?new Date(a.lastMessage.createdAt).toLocaleDateString():"",[a.lastMessage]),g=a.lastMessage?.content||"No messages yet",h=a.unreadCount>0?` with ${a.unreadCount} unread messages`:"";return(0,b.jsx)(e.default,{href:`/buyer/messages?userId=${a.user.id}`,className:"block rounded-lg border bg-card p-4 hover:bg-accent transition-colors focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-ring","aria-label":`Chat with ${a.user.name}${d?", online":""}${h}. Last message: ${g}`,children:(0,b.jsxs)("article",{className:"flex items-center space-x-4",children:[(0,b.jsx)(l.default,{src:a.user.avatar,alt:a.user.name,size:"lg",showOnlineStatus:!0,isOnline:d}),(0,b.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,b.jsxs)("div",{className:"flex items-center justify-between mb-1",children:[(0,b.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,b.jsx)("h3",{className:"font-semibold truncate",id:`conversation-${a.user.id}-name`,children:a.user.name}),d&&(0,b.jsxs)("span",{className:"text-xs text-green-500 flex items-center","aria-label":"Online now",children:[(0,b.jsx)(m.Circle,{className:"h-2 w-2 fill-current mr-1","aria-hidden":"true"}),(0,b.jsx)("span",{children:"Online"})]})]}),(0,b.jsx)("time",{className:"text-xs text-muted-foreground",dateTime:a.lastMessage?.createdAt,"aria-label":`Last message on ${f}`,children:f})]}),(0,b.jsx)("p",{className:"text-sm text-muted-foreground truncate","aria-labelledby":`conversation-${a.user.id}-name`,children:g})]}),a.unreadCount>0&&(0,b.jsx)("div",{className:"flex-shrink-0",children:(0,b.jsx)("span",{className:"inline-flex items-center justify-center w-6 h-6 rounded-full bg-primary text-primary-foreground text-xs font-medium","aria-label":`${a.unreadCount} unread messages`,children:a.unreadCount})})]})})});a.i(59888);var o=a.i(98534);function p(){let a=(0,d.useRouter)(),{isAuthenticated:l}=(0,h.useAuth)(),{socket:m,isConnected:p,onlineUsers:q}=(0,i.useSocket)(),[r,s]=(0,c.useState)([]),[t,u]=(0,c.useState)(!0),v=(0,c.useCallback)(async()=>{try{let a=await g.messagesAPI.getConversations();s(a.data.conversations||[])}catch(a){console.error("Failed to fetch conversations:",a),o.toast.error("Failed to load conversations.")}finally{u(!1)}},[]);return((0,c.useEffect)(()=>{l?v():a.push("/login")},[l,a,v]),(0,c.useEffect)(()=>{if(m&&p)return m.on("notification:message",({message:a,unreadCount:b})=>{s(c=>{let d=a.sender._id,e=a.receiver._id,f=JSON.parse(localStorage.getItem("user")||"{}")._id,g=d===f?e:d,h=c.findIndex(a=>a.user.id===g);if(-1===h)return v(),c;{let e=[...c];return e[h]={...e[h],lastMessage:{sender:a.sender._id,receiver:a.receiver._id,product:a.product,content:a.content,isRead:a.isRead,createdAt:a.createdAt},unreadCount:d===f?0:b},[e[h],...e.filter((a,b)=>b!==h)]}})}),()=>{m.off("notification:message")}},[m,p,v]),t)?(0,b.jsx)("div",{className:"container mx-auto px-4 py-8",children:(0,b.jsxs)("div",{className:"max-w-4xl mx-auto",children:[(0,b.jsx)("div",{className:"flex items-center justify-between mb-8",children:(0,b.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,b.jsx)("div",{className:"h-8 w-8 bg-muted rounded-full animate-pulse"}),(0,b.jsx)("div",{className:"h-8 bg-muted rounded w-48 animate-pulse"})]})}),(0,b.jsx)(k.MessageListSkeleton,{count:8})]})}):(0,b.jsx)("div",{className:"container mx-auto px-4 py-8",children:(0,b.jsxs)("div",{className:"max-w-4xl mx-auto",children:[(0,b.jsxs)("div",{className:"flex items-center justify-between mb-8",children:[(0,b.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,b.jsx)(f.MessageCircle,{className:"h-8 w-8 text-primary"}),(0,b.jsx)("h1",{className:"text-3xl font-bold",children:"Messages"})]}),(0,b.jsxs)("div",{className:"flex items-center space-x-2 text-sm text-muted-foreground",children:[(0,b.jsx)("div",{className:`w-2 h-2 rounded-full ${p?"bg-green-500":"bg-red-500"}`}),(0,b.jsx)("span",{children:p?"Connected":"Reconnecting..."})]})]}),0===r.length?(0,b.jsxs)("div",{className:"text-center py-16",children:[(0,b.jsx)(f.MessageCircle,{className:"h-24 w-24 mx-auto text-muted-foreground mb-4"}),(0,b.jsx)("h2",{className:"text-2xl font-semibold mb-2",children:"No messages yet"}),(0,b.jsx)("p",{className:"text-muted-foreground mb-6",children:"Start a conversation with a seller or buyer"}),(0,b.jsx)(e.default,{href:"/products",className:"inline-flex items-center space-x-2",children:(0,b.jsx)(j.default,{children:"Browse Products"})})]}):(0,b.jsx)("div",{className:"space-y-2",children:r.map(a=>{let c=q.has(a.user.id);return(0,b.jsx)(n,{conversation:a,isOnline:c},a.user.id)})})]})})}a.s(["default",()=>p],56846)}];

//# sourceMappingURL=frontend_426e495f._.js.map