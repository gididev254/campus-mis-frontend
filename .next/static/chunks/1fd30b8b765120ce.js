(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,80658,e=>{"use strict";var t=e.i(48277),i=e.i(99738);function r({children:e,className:r,variant:s="primary",size:o="md",isLoading:a=!1,loadingText:l,disabled:d,...c}){return(0,t.jsx)("button",{type:c.type||"button",className:(0,i.cn)("inline-flex items-center justify-center rounded-lg font-medium transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-offset-2 focus-visible:ring-ring disabled:opacity-50 disabled:pointer-events-none disabled:cursor-not-allowed",{primary:"bg-primary text-primary-foreground hover:opacity-90 focus-visible:ring-primary",secondary:"bg-secondary text-secondary-foreground hover:opacity-90 focus-visible:ring-secondary",outline:"border border-border hover:bg-accent hover:text-accent-foreground focus-visible:ring-border",ghost:"hover:bg-accent hover:text-accent-foreground focus-visible:ring-accent",danger:"bg-destructive text-destructive-foreground hover:opacity-90 focus-visible:ring-destructive"}[s],{sm:"px-3 py-1.5 text-sm",md:"px-4 py-2 text-base",lg:"px-6 py-3 text-lg"}[o],r),disabled:d||a,"aria-live":a?"polite":void 0,"aria-busy":a,...c,children:a?(0,t.jsxs)(t.Fragment,{children:[(0,t.jsxs)("svg",{className:"animate-spin -ml-1 mr-2 h-4 w-4",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","aria-hidden":"true",role:"img",children:[(0,t.jsx)("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),(0,t.jsx)("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),(0,t.jsx)("span",{children:l||"Loading..."})]}):e})}e.s(["default",()=>r])},33189,e=>{"use strict";let t=(0,e.i(35884).default)("arrow-left",[["path",{d:"m12 19-7-7 7-7",key:"1l729n"}],["path",{d:"M19 12H5",key:"x3x0zl"}]]);e.s(["ArrowLeft",()=>t],33189)},50042,e=>{"use strict";var t=e.i(48277),i=e.i(30668),r=e.i(99738);function s({label:e,error:s,helperText:o,className:a,id:l,...d}){let c=i.default.useId(),n=l||c,u=s?`${n}-error`:void 0,m=o?`${n}-helper`:void 0,p=[u,m].filter(Boolean).join(" ")||void 0;return(0,t.jsxs)("div",{className:"w-full",children:[e&&(0,t.jsxs)("label",{htmlFor:n,className:"block text-sm font-medium mb-1.5 text-foreground",children:[e,d.required&&(0,t.jsx)("span",{className:"text-destructive ml-1","aria-label":"required",children:"*"})]}),(0,t.jsx)("input",{id:n,"aria-invalid":s?"true":"false","aria-describedby":p,"aria-required":d.required?"true":void 0,className:(0,r.cn)("w-full px-4 py-2.5 rounded-lg border border-input bg-background text-foreground","placeholder:text-muted-foreground","focus:outline-none focus:ring-2 focus:ring-ring focus:border-transparent focus-visible:ring-2 focus-visible:ring-offset-2","disabled:opacity-50 disabled:cursor-not-allowed",s&&"border-destructive focus:ring-destructive focus-visible:ring-destructive",a),...d}),s&&(0,t.jsx)("p",{id:u,className:"mt-1 text-sm text-destructive",role:"alert","aria-live":"assertive",children:s}),o&&!s&&(0,t.jsx)("p",{id:m,className:"mt-1 text-sm text-muted-foreground",children:o})]})}e.s(["default",()=>s])},768,e=>{"use strict";let t=(0,e.i(35884).default)("upload",[["path",{d:"M12 3v12",key:"1x0j5s"}],["path",{d:"m17 8-5-5-5 5",key:"7q97r8"}],["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}]]);e.s(["Upload",()=>t],768)},18660,e=>{"use strict";var t=e.i(48277),i=e.i(30668),r=e.i(96086),s=e.i(33189),o=e.i(768),a=e.i(87635),l=e.i(80380),d=e.i(16506),c=e.i(42588),n=e.i(46471),u=e.i(42854),m=e.i(40206),p=e.i(91482),g=e.i(64076),x=e.i(45932),h=e.i(80658),f=e.i(50042);e.i(92544);var b=e.i(11897);let v=x.productSchema.pick({title:!0,description:!0,price:!0,category:!0,condition:!0,location:!0,isNegotiable:!0});function j(){let e=(0,r.useRouter)(),x=(0,r.useParams)(),{user:j}=(0,m.useAuth)(),[y,N]=(0,i.useState)(null),[w,k]=(0,i.useState)([]),[P,S]=(0,i.useState)(!0),[C,F]=(0,i.useState)(!1),[A,z]=(0,i.useState)([]),[L,B]=(0,i.useState)(""),{register:$,handleSubmit:U,formState:{errors:q,isSubmitting:M},setError:E,setValue:I,reset:R,watch:T}=(0,n.useForm)({resolver:(0,u.zodResolver)(v),mode:"onBlur",defaultValues:{condition:"good",location:j?.location||"",isNegotiable:!1}}),_=T("isNegotiable");(0,i.useEffect)(()=>{let e=async()=>{try{let e=await g.categoriesAPI.getCategories();k(e.data.categories);let t=(await p.productsAPI.getProduct(x.id)).data.product;if(t.seller?._id!==j?._id&&j?.role!=="admin"){B("You are not authorized to edit this product"),S(!1);return}N(t),z(t.images||[]),R({title:t.title||"",description:t.description||"",price:t.price?.toString()||"",category:t.category?._id||"",condition:t.condition||"good",location:t.location||"",isNegotiable:t.isNegotiable||!1})}catch(e){console.error("Failed to fetch data:",e),B(e.response?.data?.message||"Failed to load product")}finally{S(!1)}};j&&e()},[x.id,j,R]);let D=async e=>{let t=e.target.files;if(!t||0===t.length)return;if(A.length+t.length>5)return void b.toast.error("You can only upload up to 5 images");F(!0);let i=[];for(let e=0;e<t.length;e++){let r=t[e],s=new FormData;s.append("image",r);try{let e=await fetch("http://localhost:5000/api/v1/upload/image",{method:"POST",headers:{Authorization:`Bearer ${localStorage.getItem("token")}`},body:s}),t=await e.json();t.success&&i.push(t.data.url)}catch(t){console.error("Failed to upload image:",t);let e=URL.createObjectURL(r);i.push(e)}}z([...A,...i]),F(!1)},H=async t=>{if(0===A.length)return void E("root",{type:"manual",message:"At least one image is required"});if(A.length>5)return void E("root",{type:"manual",message:"Maximum 5 images allowed"});try{let i=new FormData;i.append("title",t.title),i.append("description",t.description),i.append("price",t.price),i.append("category",t.category),i.append("condition",t.condition),i.append("location",t.location),i.append("isNegotiable",t.isNegotiable.toString()),A.forEach(e=>i.append("images",e)),await p.productsAPI.updateProduct(x.id,i),b.toast.success("Product updated successfully!"),e.push(`/products/${x.id}`)}catch(t){console.error("Failed to update product:",t),b.toast.error("Failed to update product.");let e=t.response?.data?.message||"Failed to update product";B(e),E("root",{type:"manual",message:e})}};return P?(0,t.jsx)("div",{className:"container mx-auto px-4 py-16",children:(0,t.jsxs)("div",{className:"max-w-3xl mx-auto text-center",children:[(0,t.jsx)(l.Loader2,{className:"h-12 w-12 animate-spin mx-auto mb-4 text-primary"}),(0,t.jsx)("p",{className:"text-muted-foreground",children:"Loading product..."})]})}):L&&!y?(0,t.jsx)("div",{className:"container mx-auto px-4 py-16",children:(0,t.jsxs)("div",{className:"max-w-3xl mx-auto text-center",children:[(0,t.jsx)("div",{className:"p-4 rounded-lg bg-destructive/10 text-destructive mb-6",children:L}),(0,t.jsx)(d.default,{href:"/seller/products",children:(0,t.jsx)(h.default,{children:"Back to Products"})})]})}):(0,t.jsxs)("div",{className:"container mx-auto px-4 py-8 max-w-3xl",children:[(0,t.jsxs)("div",{className:"mb-8",children:[(0,t.jsxs)(d.default,{href:`/products/${x.id}`,className:"inline-flex items-center space-x-2 text-muted-foreground hover:text-foreground mb-4",children:[(0,t.jsx)(s.ArrowLeft,{className:"h-4 w-4"}),(0,t.jsx)("span",{children:"Back to Product"})]}),(0,t.jsx)("h1",{className:"text-3xl font-bold",children:"Edit Product"})]}),L&&(0,t.jsx)("div",{className:"mb-6 p-4 rounded-lg bg-destructive/10 text-destructive",children:L}),(0,t.jsxs)("form",{onSubmit:U(H),className:"space-y-6",noValidate:!0,children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-sm font-medium mb-3",children:"Product Images"}),(0,t.jsxs)("div",{className:"border-2 border-dashed rounded-lg p-8 text-center",children:[(0,t.jsx)("input",{type:"file",id:"images",multiple:!0,accept:"image/*",onChange:D,className:"hidden",disabled:C||A.length>=5}),(0,t.jsxs)("label",{htmlFor:"images",className:"cursor-pointer",children:[(0,t.jsx)(o.Upload,{className:"h-12 w-12 mx-auto mb-4 text-muted-foreground"}),(0,t.jsx)("p",{className:"text-sm text-muted-foreground",children:C?"Uploading...":"Click to upload images (max 5)"}),(0,t.jsx)("p",{className:"text-xs text-muted-foreground mt-1",children:"PNG, JPG up to 5MB each"})]})]}),A.length>0&&(0,t.jsx)("div",{className:"grid grid-cols-5 gap-4 mt-4",children:A.map((e,i)=>(0,t.jsxs)("div",{className:"relative aspect-square rounded-lg overflow-hidden border",children:[(0,t.jsx)(c.default,{src:e,alt:`Upload ${i+1}`,fill:!0,className:"object-cover",sizes:"100px"}),(0,t.jsx)("button",{type:"button",onClick:()=>{z(A.filter((e,t)=>t!==i))},className:"absolute top-1 right-1 p-1 bg-destructive text-destructive-foreground rounded-full opacity-0 hover:opacity-100 transition-opacity",children:(0,t.jsx)(a.X,{className:"h-4 w-4"})})]},i))})]}),(0,t.jsx)(f.default,{label:"Title",type:"text",placeholder:"e.g., iPhone 13 Pro - Excellent Condition",error:q.title?.message,...$("title")}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-sm font-medium mb-2",children:"Description"}),(0,t.jsx)("textarea",{...$("description"),placeholder:"Describe your product in detail...",rows:5,className:`w-full px-4 py-3 rounded-lg border bg-background focus:outline-none focus:ring-2 focus:ring-ring resize-none ${q.description?"border-destructive focus:ring-destructive":"border-input"}`}),q.description&&(0,t.jsx)("p",{className:"mt-1 text-sm text-destructive",children:q.description.message})]}),(0,t.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,t.jsx)("div",{children:(0,t.jsx)(f.default,{label:"Price (KES)",type:"number",placeholder:"5000",error:q.price?.message,...$("price")})}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-sm font-medium mb-2",children:"Category"}),(0,t.jsxs)("select",{...$("category"),className:`w-full px-4 py-3 rounded-lg border bg-background focus:outline-none focus:ring-2 focus:ring-ring ${q.category?"border-destructive focus:ring-destructive":"border-input"}`,children:[(0,t.jsx)("option",{value:"",children:"Select a category"}),w.map(e=>(0,t.jsx)("option",{value:e._id,children:e.name},e._id))]}),q.category&&(0,t.jsx)("p",{className:"mt-1 text-sm text-destructive",children:q.category.message})]})]}),(0,t.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-sm font-medium mb-2",children:"Condition"}),(0,t.jsxs)("select",{...$("condition"),className:"w-full px-4 py-3 rounded-lg border border-input bg-background focus:outline-none focus:ring-2 focus:ring-ring",children:[(0,t.jsx)("option",{value:"new",children:"New"}),(0,t.jsx)("option",{value:"like-new",children:"Like New"}),(0,t.jsx)("option",{value:"good",children:"Good"}),(0,t.jsx)("option",{value:"fair",children:"Fair"})]}),q.condition&&(0,t.jsx)("p",{className:"mt-1 text-sm text-destructive",children:q.condition.message})]}),(0,t.jsx)(f.default,{label:"Location",type:"text",placeholder:"e.g., Main Campus, Hostel A",error:q.location?.message,...$("location")})]}),(0,t.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,t.jsx)("input",{type:"checkbox",id:"negotiable",...$("isNegotiable"),checked:_,onChange:e=>I("isNegotiable",e.target.checked),className:"w-4 h-4 rounded border-input"}),(0,t.jsx)("label",{htmlFor:"negotiable",className:"text-sm font-medium",children:"Price is negotiable"})]}),(0,t.jsxs)("div",{className:"flex items-center space-x-4 pt-4",children:[(0,t.jsx)(h.default,{type:"submit",size:"lg",isLoading:M,children:"Save Changes"}),(0,t.jsx)(d.default,{href:`/products/${x.id}`,children:(0,t.jsx)(h.default,{type:"button",variant:"outline",size:"lg",children:"Cancel"})})]})]})]})}e.s(["default",()=>j])}]);