(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,80658,e=>{"use strict";var s=e.i(48277),t=e.i(99738);function r({children:e,className:r,variant:a="primary",size:i="md",isLoading:n=!1,loadingText:l,disabled:o,...c}){return(0,s.jsx)("button",{type:c.type||"button",className:(0,t.cn)("inline-flex items-center justify-center rounded-lg font-medium transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-offset-2 focus-visible:ring-ring disabled:opacity-50 disabled:pointer-events-none disabled:cursor-not-allowed",{primary:"bg-primary text-primary-foreground hover:opacity-90 focus-visible:ring-primary",secondary:"bg-secondary text-secondary-foreground hover:opacity-90 focus-visible:ring-secondary",outline:"border border-border hover:bg-accent hover:text-accent-foreground focus-visible:ring-border",ghost:"hover:bg-accent hover:text-accent-foreground focus-visible:ring-accent",danger:"bg-destructive text-destructive-foreground hover:opacity-90 focus-visible:ring-destructive"}[a],{sm:"px-3 py-1.5 text-sm",md:"px-4 py-2 text-base",lg:"px-6 py-3 text-lg"}[i],r),disabled:o||n,"aria-live":n?"polite":void 0,"aria-busy":n,...c,children:n?(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)("svg",{className:"animate-spin -ml-1 mr-2 h-4 w-4",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","aria-hidden":"true",role:"img",children:[(0,s.jsx)("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),(0,s.jsx)("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),(0,s.jsx)("span",{children:l||"Loading..."})]}):e})}e.s(["default",()=>r])},35384,e=>{"use strict";var s=e.i(48277),t=e.i(30668),r=e.i(46669);class a extends t.Component{constructor(e){super(e),this.state={hasError:!1,error:null}}static getDerivedStateFromError(e){return{hasError:!0,error:e}}componentDidCatch(e,s){console.error("ClientErrorBoundary caught an error:",e,s)}resetError=()=>{this.setState({hasError:!1,error:null})};render(){if(this.state.hasError){let e=this.props.fallback||r.ErrorFallback;return(0,s.jsx)(e,{error:this.state.error,resetError:this.resetError})}return this.props.children}}e.s(["ClientErrorBoundary",()=>a])},50042,e=>{"use strict";var s=e.i(48277),t=e.i(30668),r=e.i(99738);function a({label:e,error:a,helperText:i,className:n,id:l,...o}){let c=t.default.useId(),d=l||c,u=a?`${d}-error`:void 0,m=i?`${d}-helper`:void 0,x=[u,m].filter(Boolean).join(" ")||void 0;return(0,s.jsxs)("div",{className:"w-full",children:[e&&(0,s.jsxs)("label",{htmlFor:d,className:"block text-sm font-medium mb-1.5 text-foreground",children:[e,o.required&&(0,s.jsx)("span",{className:"text-destructive ml-1","aria-label":"required",children:"*"})]}),(0,s.jsx)("input",{id:d,"aria-invalid":a?"true":"false","aria-describedby":x,"aria-required":o.required?"true":void 0,className:(0,r.cn)("w-full px-4 py-2.5 rounded-lg border border-input bg-background text-foreground","placeholder:text-muted-foreground","focus:outline-none focus:ring-2 focus:ring-ring focus:border-transparent focus-visible:ring-2 focus-visible:ring-offset-2","disabled:opacity-50 disabled:cursor-not-allowed",a&&"border-destructive focus:ring-destructive focus-visible:ring-destructive",n),...o}),a&&(0,s.jsx)("p",{id:u,className:"mt-1 text-sm text-destructive",role:"alert","aria-live":"assertive",children:a}),i&&!a&&(0,s.jsx)("p",{id:m,className:"mt-1 text-sm text-muted-foreground",children:i})]})}e.s(["default",()=>a])},33189,e=>{"use strict";let s=(0,e.i(35884).default)("arrow-left",[["path",{d:"m12 19-7-7 7-7",key:"1l729n"}],["path",{d:"M19 12H5",key:"x3x0zl"}]]);e.s(["ArrowLeft",()=>s],33189)},216,e=>{"use strict";let s=(0,e.i(35884).default)("check",[["path",{d:"M20 6 9 17l-5-5",key:"1gmf2c"}]]);e.s(["Check",()=>s],216)},32070,e=>{"use strict";var s=e.i(48277),t=e.i(42588),r=e.i(30668),a=e.i(99738),i=e.i(67494),n=e.i(33991);let l={sm:"w-8 h-8",md:"w-10 h-10",lg:"w-12 h-12",xl:"w-16 h-16"},o=(0,r.memo)(function({src:e,alt:o,size:c="md",className:d,priority:u=!1,showOnlineStatus:m=!1,isOnline:x=!1}){let[f,h]=(0,r.useState)(!1),{sizeClass:p,customSize:g}=(0,r.useMemo)(()=>({sizeClass:"number"==typeof c?"":l[c],customSize:"number"==typeof c?{width:c,height:c}:{}}),[c]),v=(0,r.useMemo)(()=>n.IMAGE_SIZES.avatar,[]),b=(0,r.useCallback)(()=>{h(!0)},[]),y=(0,r.useMemo)(()=>{let e=o.trim().split(" ");return e.length>=2?`${e[0][0]}${e[1][0]}`.toUpperCase():o[0].toUpperCase()},[o]),j=(0,r.useMemo)(()=>x?"bg-green-500":"bg-gray-400",[x]);return(0,s.jsxs)("div",{className:(0,a.cn)("relative rounded-full overflow-hidden bg-primary/10 flex items-center justify-center flex-shrink-0",p,d),style:g,children:[e&&!f?(0,s.jsx)(t.default,{src:e,alt:o,fill:!0,className:"object-cover",sizes:v,priority:u,placeholder:"blur",blurDataURL:n.DEFAULT_BLUR_DATA_URL,onError:b}):(0,s.jsx)("div",{className:"w-full h-full flex items-center justify-center text-primary font-semibold",children:y||(0,s.jsx)(i.User,{className:"h-1/2 w-1/2"})}),m&&(0,s.jsx)("span",{className:(0,a.cn)("absolute bottom-0 right-0 w-3 h-3 border-2 border-background rounded-full transition-colors",j),"aria-label":x?"Online":"Offline"})]})});e.s(["default",0,o])},18071,e=>{"use strict";let s=(0,e.i(35884).default)("circle",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}]]);e.s(["Circle",()=>s],18071)},66929,e=>{"use strict";var s=e.i(48277),t=e.i(30668),r=e.i(96086),a=e.i(16506),i=e.i(32070),n=e.i(80380);let l=(0,e.i(35884).default)("send",[["path",{d:"M14.536 21.686a.5.5 0 0 0 .937-.024l6.5-19a.496.496 0 0 0-.635-.635l-19 6.5a.5.5 0 0 0-.024.937l7.93 3.18a2 2 0 0 1 1.112 1.11z",key:"1ffxy3"}],["path",{d:"m21.854 2.147-10.94 10.939",key:"12cjpa"}]]);var o=e.i(33189),c=e.i(42350),d=e.i(216),u=e.i(47022),m=e.i(18071),x=e.i(51740),f=e.i(40206),h=e.i(82173),p=e.i(80658),g=e.i(50042),v=e.i(35384);function b(){return(0,s.jsx)(v.ClientErrorBoundary,{children:(0,s.jsx)(y,{})})}function y(){let e=(0,r.useRouter)(),v=(0,r.useSearchParams)(),{user:b,isAuthenticated:y}=(0,f.useAuth)(),{socket:j,isConnected:N,onlineUsers:w,isReconnecting:S,emitWithQueue:k,queuedMessageCount:C}=(0,h.useSocket)(),_=v.get("userId"),E=(0,t.useRef)(null),A=(0,t.useRef)(null),[$,I]=(0,t.useState)([]),[R,L]=(0,t.useState)(!0),[T,D]=(0,t.useState)(!1),[M,O]=(0,t.useState)(""),[F,U]=(0,t.useState)(null),[z,B]=(0,t.useState)(""),[q,P]=(0,t.useState)(!1),[V,W]=(0,t.useState)(!1),[G,H]=(0,t.useState)(!1);(0,t.useEffect)(()=>{y?_&&K():e.push("/login")},[y,_,e]),(0,t.useEffect)(()=>{E.current?.scrollIntoView({behavior:"smooth"})},[$]),(0,t.useEffect)(()=>{if(j&&N&&_&&b?._id)return[b._id,_].sort().join(":"),j.emit("join:conversation",{userId:_}),j.on("message:new",e=>{I(s=>s.some(s=>s._id===e._id)?s:[...s,e])}),j.on("typing:start",({userId:e})=>{e===_&&W(!0)}),j.on("typing:stop",({userId:e})=>{e===_&&W(!1)}),j.on("message:read",({messageId:e})=>{I(s=>s.map(s=>s._id===e?{...s,isRead:!0,readAt:new Date().toISOString()}:s))}),()=>{j.emit("leave:conversation",{userId:_}),j.off("message:new"),j.off("typing:start"),j.off("typing:stop"),j.off("message:read")}},[j,N,_,b?._id]);let K=async()=>{try{let e=await x.messagesAPI.getConversation(_);if(I(e.data.data||[]),e.data.data.length>0){let s=e.data.data[0];U(s.sender._id===_?s.sender:s.receiver)}}catch(e){console.error("Failed to fetch messages:",e),toast.error("Failed to load messages."),B("Failed to load messages. Please try again.")}finally{L(!1)}},Z=async e=>{if(e.preventDefault(),!M.trim())return;A.current&&clearTimeout(A.current),j&&N&&j.emit("typing:stop",{userId:_}),D(!0),B("");let s={_id:`temp-${Date.now()}`,sender:{_id:b?._id||"",name:b?.name||"",email:b?.email||"",role:b?.role||"buyer",phone:b?.phone||"",avatar:b?.avatar},receiver:{_id:_||"",name:F?.name||"",email:F?.email||"",role:F?.role||"seller",phone:F?.phone||"",avatar:F?.avatar},content:M,createdAt:new Date().toISOString(),isRead:!1};I(e=>[...e,s]),O("");try{await x.messagesAPI.sendMessage({receiver:_,content:M})}catch(e){I(e=>e.filter(e=>e._id!==s._id)),B(e instanceof Error&&"response"in e&&e.response?.data?.message||"Failed to send message"),O(M)}finally{D(!1)}},J=F&&w.has(F._id);return R?(0,s.jsx)("div",{className:"container mx-auto px-4 py-16",children:(0,s.jsxs)("div",{className:"max-w-4xl mx-auto text-center",children:[(0,s.jsx)(n.Loader2,{className:"h-12 w-12 animate-spin mx-auto mb-4 text-primary"}),(0,s.jsx)("p",{className:"text-muted-foreground",children:"Loading messages..."})]})}):(0,s.jsx)("div",{className:"container mx-auto px-4 py-8",children:(0,s.jsxs)("div",{className:"max-w-4xl mx-auto",children:[(0,s.jsxs)("div",{className:"flex items-center justify-between mb-6",children:[(0,s.jsxs)("div",{className:"flex items-center space-x-4",children:[(0,s.jsx)(p.default,{variant:"ghost",onClick:()=>e.back(),className:"p-2","aria-label":"Go back",children:(0,s.jsx)(o.ArrowLeft,{className:"h-5 w-5"})}),(0,s.jsxs)("div",{className:"flex items-center space-x-3",children:[F&&(0,s.jsx)(i.default,{src:F.avatar,alt:F.name,size:"md",showOnlineStatus:!0,isOnline:J}),(0,s.jsxs)("div",{children:[(0,s.jsxs)("h1",{className:"text-2xl font-bold flex items-center space-x-2",children:[(0,s.jsx)("span",{children:F?.name||"Messages"}),J&&(0,s.jsxs)("span",{className:"text-sm font-normal text-green-500 flex items-center",children:[(0,s.jsx)(m.Circle,{className:"h-2 w-2 fill-current mr-1"}),"Online"]})]}),(0,s.jsx)("p",{className:"text-sm text-muted-foreground",children:V?(0,s.jsx)("span",{className:"text-primary animate-pulse",children:"Typing..."}):S?(0,s.jsx)("span",{className:"text-yellow-500 animate-pulse",children:"Reconnecting..."}):J?"Active now":"Offline"})]})]})]}),(0,s.jsxs)("div",{className:"flex items-center space-x-2 text-sm text-muted-foreground",children:[(0,s.jsx)("div",{className:`w-2 h-2 rounded-full ${N?"bg-green-500":S?"bg-yellow-500 animate-pulse":"bg-red-500"}`}),(0,s.jsxs)("span",{children:[N?"Connected":S?"Reconnecting...":"Disconnected",C>0&&` (${C} queued)`]})]})]}),(0,s.jsxs)("div",{className:"rounded-lg border bg-card p-6",children:[z&&(0,s.jsxs)("div",{className:"mb-4 p-3 rounded-lg bg-destructive/10 text-destructive text-sm flex items-center space-x-2",children:[(0,s.jsx)(c.AlertCircle,{className:"h-4 w-4 flex-shrink-0"}),(0,s.jsx)("p",{children:z})]}),(0,s.jsxs)("div",{className:"space-y-4 mb-6 max-h-[60vh] overflow-y-auto",children:[0===$.length?(0,s.jsx)("div",{className:"text-center py-12 text-muted-foreground",children:"No messages yet. Start the conversation!"}):$.map(e=>{let t=e.sender._id===b?._id,r=e._id.startsWith("temp-");return(0,s.jsx)("div",{className:`flex ${t?"justify-end":"justify-start"}`,children:(0,s.jsxs)("div",{className:`max-w-[70%] ${t?"order-2":"order-1"}`,children:[(0,s.jsxs)("div",{className:`rounded-lg p-4 ${t?"bg-primary text-primary-foreground":"bg-muted"} ${r?"opacity-60":""}`,children:[(0,s.jsx)("p",{className:"text-sm whitespace-pre-wrap break-words",children:e.content}),e.product&&(0,s.jsx)(a.default,{href:`/products/${e.product._id}`,className:"text-xs underline opacity-80 hover:opacity-100 inline-block mt-2",children:"View Product"})]}),(0,s.jsxs)("div",{className:"flex items-center justify-end space-x-1 mt-1 px-2",children:[(0,s.jsx)("p",{className:"text-xs text-muted-foreground",children:new Date(e.createdAt).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})}),t&&(0,s.jsx)("span",{className:"text-xs",children:e.isRead?(0,s.jsx)(u.CheckCheck,{className:"h-3 w-3 text-blue-500 inline"}):(0,s.jsx)(d.Check,{className:"h-3 w-3 text-muted-foreground inline"})}),r&&(0,s.jsx)(n.Loader2,{className:"h-3 w-3 animate-spin text-muted-foreground"})]})]})},e._id)}),(0,s.jsx)("div",{ref:E})]}),(0,s.jsxs)("form",{onSubmit:Z,className:"flex space-x-3",children:[(0,s.jsx)(g.default,{type:"text",value:M,onChange:e=>{O(e.target.value),j&&N&&_&&(k("typing:start",{userId:_}),A.current&&clearTimeout(A.current),A.current=setTimeout(()=>{N&&k("typing:stop",{userId:_})},2e3))},placeholder:S?"Reconnecting to server...":C>0?`Sending ${C} queued message${C>1?"s":""}...`:"Type a message...",className:"flex-1",disabled:T||S}),(0,s.jsxs)(p.default,{type:"submit",disabled:T||!M.trim()||S,isLoading:T,className:"px-4",title:S?"Waiting for connection...":C>0?`${C} message${C>1?"s":""} in queue`:"Send message",children:[(0,s.jsx)(l,{className:"h-5 w-5"}),C>0&&(0,s.jsx)("span",{className:"ml-2 text-xs bg-yellow-500 text-white px-2 py-0.5 rounded-full",children:C})]})]})]})]})})}e.s(["default",()=>b],66929)}]);