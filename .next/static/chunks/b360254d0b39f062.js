(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,33046,e=>{"use strict";var t=e.i(48277),s=e.i(30668),a=e.i(10850);function r(){let[e,r]=(0,s.useState)("testbuyer@example.com"),[l,o]=(0,s.useState)("Test@Password123"),[n,i]=(0,s.useState)([]),[d,c]=(0,s.useState)(!1),h=(e,t,s,a)=>{i(r=>[...r,{name:e,status:t,message:s,duration:a}])},u=()=>{i([])},m=async(e,t)=>{let s=performance.now();try{await t();let a=performance.now()-s;h(e,"success","Test passed",a)}catch(a){let t=performance.now()-s;h(e,"error",a.response?.data?.message||a.message||"Test failed",t)}},g=async()=>{let t=await a.authAPI.login({email:e,password:l});if(t.data.success&&t.data.token)return localStorage.setItem("token",t.data.token),localStorage.setItem("user",JSON.stringify(t.data.user)),t.data.token;throw Error("Login failed - no token received")},x=async()=>{let e=localStorage.getItem("token");if(!e)throw Error("No token found in localStorage");let t=await a.authAPI.refreshToken(e);if(t.data.success&&t.data.token){let e=t.data.token;if(localStorage.setItem("token",e),!(await a.authAPI.getMe()).data.success)throw Error("New token does not work");return e}throw Error("Token refresh failed - no new token received")},p=async()=>{try{throw await a.authAPI.refreshToken("invalid.token.here"),Error("Should have failed with invalid token")}catch(e){if(e.response?.status===401)return;throw e}},f=async()=>{try{throw await a.authAPI.refreshToken(null),Error("Should have failed with null token")}catch(e){if(e.response?.status===400||e.response?.status===401)return;throw e}},w=async()=>{u(),c(!0),await m("1. User Login",async()=>{await g()}),await m("2. Verify Current Token",async()=>{if(!(await a.authAPI.getMe()).data.success)throw Error("Could not verify current token")}),await m("3. Token Refresh",async()=>{await x()}),await m("4. Verify Refreshed Token",async()=>{if(!(await a.authAPI.getMe()).data.success)throw Error("Could not verify refreshed token")}),await m("5. Refresh with Invalid Token",async()=>{await p()}),await m("6. Refresh with Malformed Token",async()=>{await f()}),await m("7. Token Structure Check",async()=>{let e=localStorage.getItem("token");if(!e)throw Error("No token found");let t=e.split(".");if(3!==t.length)throw Error("Invalid JWT structure");let s=JSON.parse(atob(t[1]));if(!s.id||!s.iat||!s.exp)throw Error("Token missing required claims");let a=new Date(1e3*s.exp),r=new Date,l=Math.floor((a.getTime()-r.getTime())/1e3/60);if(l<0)throw Error("Token has expired");console.log("Token payload:",s),console.log("Time to expiry:",l,"minutes")}),c(!1)},y=async()=>{u(),c(!0);try{h("1. Initial Login","pending","Logging in...");let e=await g();h("1. Initial Login","success",`Token received: ${e.substring(0,20)}...`),h("2. Simulate Token Expiration","pending","Corrupting token..."),e.substring(0,e.length-10),h("2. Simulate Token Expiration","success","Token corrupted"),h("3. Attempt API Call with Corrupted Token","pending","Testing auto-refresh...");try{localStorage.setItem("token",e),await a.authAPI.getMe(),h("3. Attempt API Call with Valid Token","success","API call successful")}catch(e){h("3. Attempt API Call with Corrupted Token","error","API call failed")}}catch(e){h("Simulation Error","error",e.message)}c(!1)};return(0,t.jsx)("div",{className:"min-h-screen bg-gray-50 py-12 px-4",children:(0,t.jsx)("div",{className:"max-w-4xl mx-auto",children:(0,t.jsxs)("div",{className:"bg-white rounded-lg shadow-md p-8",children:[(0,t.jsx)("h1",{className:"text-3xl font-bold text-gray-900 mb-2",children:"JWT Token Refresh Test"}),(0,t.jsx)("p",{className:"text-gray-600 mb-8",children:"This page tests the JWT token refresh mechanism implemented in the Campus Market frontend."}),(0,t.jsxs)("div",{className:"bg-gray-50 rounded-lg p-6 mb-6",children:[(0,t.jsx)("h2",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Test Configuration"}),(0,t.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{htmlFor:"email",className:"block text-sm font-medium text-gray-700 mb-1",children:"Email"}),(0,t.jsx)("input",{id:"email",type:"email",value:e,onChange:e=>r(e.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"test@example.com"})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{htmlFor:"password",className:"block text-sm font-medium text-gray-700 mb-1",children:"Password"}),(0,t.jsx)("input",{id:"password",type:"password",value:l,onChange:e=>o(e.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"••••••••"})]})]})]}),(0,t.jsxs)("div",{className:"flex flex-wrap gap-4 mb-6",children:[(0,t.jsx)("button",{onClick:w,disabled:d,className:"px-6 py-3 bg-blue-600 text-white rounded-lg hover:bg-blue-700 disabled:bg-gray-400 disabled:cursor-not-allowed font-medium",children:d?"Running Tests...":"Run All Tests"}),(0,t.jsx)("button",{onClick:y,disabled:d,className:"px-6 py-3 bg-purple-600 text-white rounded-lg hover:bg-purple-700 disabled:bg-gray-400 disabled:cursor-not-allowed font-medium",children:d?"Running...":"Test Expiration Simulation"}),(0,t.jsx)("button",{onClick:u,className:"px-6 py-3 bg-gray-600 text-white rounded-lg hover:bg-gray-700 font-medium",children:"Clear Results"})]}),n.length>0&&(0,t.jsxs)("div",{className:"border rounded-lg overflow-hidden",children:[(0,t.jsx)("div",{className:"bg-gray-50 px-6 py-4 border-b",children:(0,t.jsx)("h2",{className:"text-lg font-semibold text-gray-900",children:"Test Results"})}),(0,t.jsx)("div",{className:"divide-y",children:n.map((e,s)=>(0,t.jsxs)("div",{className:"px-6 py-4 flex items-start justify-between",children:[(0,t.jsxs)("div",{className:"flex-1",children:[(0,t.jsxs)("div",{className:"flex items-center gap-2 mb-1",children:["pending"===e.status&&(0,t.jsxs)("svg",{className:"w-5 h-5 text-yellow-500 animate-spin",fill:"none",viewBox:"0 0 24 24",children:[(0,t.jsx)("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),(0,t.jsx)("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),"success"===e.status&&(0,t.jsx)("svg",{className:"w-5 h-5 text-green-500",fill:"currentColor",viewBox:"0 0 20 20",children:(0,t.jsx)("path",{fillRule:"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z",clipRule:"evenodd"})}),"error"===e.status&&(0,t.jsx)("svg",{className:"w-5 h-5 text-red-500",fill:"currentColor",viewBox:"0 0 20 20",children:(0,t.jsx)("path",{fillRule:"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z",clipRule:"evenodd"})}),(0,t.jsx)("h3",{className:"font-medium text-gray-900",children:e.name})]}),(0,t.jsx)("p",{className:`text-sm ml-7 ${"error"===e.status?"text-red-600":"text-gray-600"}`,children:e.message})]}),void 0!==e.duration&&(0,t.jsxs)("span",{className:"text-sm text-gray-500 font-mono",children:[e.duration.toFixed(0),"ms"]})]},s))})]}),localStorage.getItem("token")&&(0,t.jsxs)("div",{className:"mt-6 bg-blue-50 rounded-lg p-6",children:[(0,t.jsx)("h2",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Current Token Info"}),(0,t.jsxs)("div",{className:"space-y-2 text-sm",children:[(0,t.jsxs)("p",{className:"text-gray-600",children:[(0,t.jsx)("span",{className:"font-medium",children:"Token:"})," ",localStorage.getItem("token")?.substring(0,40),"..."]}),(0,t.jsxs)("p",{className:"text-gray-600",children:[(0,t.jsx)("span",{className:"font-medium",children:"User:"})," ",localStorage.getItem("user")?JSON.parse(localStorage.getItem("user")).name:"N/A"]})]})]}),(0,t.jsxs)("div",{className:"mt-6 bg-yellow-50 rounded-lg p-6",children:[(0,t.jsx)("h2",{className:"text-lg font-semibold text-gray-900 mb-4",children:"How the Token Refresh Works"}),(0,t.jsxs)("ol",{className:"list-decimal list-inside space-y-2 text-sm text-gray-700",children:[(0,t.jsx)("li",{children:"When a user logs in, they receive a JWT token valid for 7 days"}),(0,t.jsx)("li",{children:"Each API request includes this token in the Authorization header"}),(0,t.jsx)("li",{children:"If the token expires (401 response), the axios interceptor catches it"}),(0,t.jsx)("li",{children:"The interceptor calls the refresh endpoint with the old token"}),(0,t.jsx)("li",{children:"The backend validates the old token and issues a new token"}),(0,t.jsx)("li",{children:"The new token is stored in localStorage and the original request is retried"}),(0,t.jsx)("li",{children:"If refresh fails, the user is logged out and redirected to login page"}),(0,t.jsx)("li",{children:"Multiple simultaneous requests with expired tokens are queued and handled together"})]})]})]})})})}e.s(["default",()=>r])}]);