(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,88255,e=>{"use strict";let t=(0,e.i(35884).default)("map-pin",[["path",{d:"M20 10c0 4.993-5.539 10.193-7.399 11.799a1 1 0 0 1-1.202 0C9.539 20.193 4 14.993 4 10a8 8 0 0 1 16 0",key:"1r0f0z"}],["circle",{cx:"12",cy:"10",r:"3",key:"ilqhr7"}]]);e.s(["MapPin",()=>t],88255)},35384,e=>{"use strict";var t=e.i(48277),r=e.i(30668),s=e.i(46669);class a extends r.Component{constructor(e){super(e),this.state={hasError:!1,error:null}}static getDerivedStateFromError(e){return{hasError:!0,error:e}}componentDidCatch(e,t){console.error("ClientErrorBoundary caught an error:",e,t)}resetError=()=>{this.setState({hasError:!1,error:null})};render(){if(this.state.hasError){let e=this.props.fallback||s.ErrorFallback;return(0,t.jsx)(e,{error:this.state.error,resetError:this.resetError})}return this.props.children}}e.s(["ClientErrorBoundary",()=>a])},59484,e=>{"use strict";let t=(0,e.i(35884).default)("package",[["path",{d:"M11 21.73a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16V8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73z",key:"1a0edw"}],["path",{d:"M12 22V12",key:"d0xqtd"}],["polyline",{points:"3.29 7 12 12 20.71 7",key:"ousv84"}],["path",{d:"m7.5 4.27 9 5.15",key:"1c824w"}]]);e.s(["Package",()=>t],59484)},37770,e=>{"use strict";var t=e.i(48277),r=e.i(42588),s=e.i(99738),a=e.i(30668),l=e.i(33991);function o({className:e,aspectRatio:r,width:a,height:l}){return(0,t.jsx)("div",{className:(0,s.cn)("animate-pulse bg-muted rounded-lg overflow-hidden",r?({square:"aspect-square",video:"aspect-video",portrait:"aspect-[3/4]",landscape:"aspect-[4/3]"})[r]:"",e),style:{width:a,height:l},"aria-hidden":"true",children:(0,t.jsx)("div",{className:"w-full h-full bg-gradient-to-r from-transparent via-muted-foreground/10 to-transparent animate-[shimmer_1.5s_infinite]"})})}function i({src:e,alt:i,fill:c=!1,width:d,height:n,className:u,priority:m=!1,sizes:p,showFallback:h=!0,fallbackText:x="No Image",showSkeleton:f=!1,blurColor:g=l.BLUR_COLORS.product}){let[y,b]=(0,a.useState)(!0),[j,N]=(0,a.useState)(!1),v=(0,t.jsx)("div",{className:(0,s.cn)("w-full h-full flex items-center justify-center text-muted-foreground text-sm",u),children:x});if(!e||j)return h?v:null;let k=(0,l.generateCloudinaryBlurDataURL)(e)||(0,l.generateColoredBlurDataURL)(g),w={src:e,alt:i,...m&&{priority:m},sizes:p,...c?{fill:!0,className:(0,s.cn)("object-cover transition-opacity duration-500 ease-in-out",y?"opacity-0":"opacity-100",u)}:{width:d,height:n,className:(0,s.cn)("object-cover transition-opacity duration-500 ease-in-out",y?"opacity-0":"opacity-100",u)},onLoad:()=>b(!1),onError:()=>N(!0),placeholder:"blur",blurDataURL:k||l.DEFAULT_BLUR_DATA_URL};return(0,t.jsxs)(t.Fragment,{children:[y&&f&&(0,t.jsx)("div",{className:"absolute inset-0 z-10",children:(0,t.jsx)(o,{className:"w-full h-full"})}),(0,t.jsx)(r.default,{...w})]})}e.s(["default",()=>i],37770)},3333,e=>{"use strict";let t=(0,e.i(35884).default)("plus",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"M12 5v14",key:"s699le"}]]);e.s(["Plus",()=>t],3333)},90294,e=>{"use strict";let t=(0,e.i(35884).default)("shopping-bag",[["path",{d:"M16 10a4 4 0 0 1-8 0",key:"1ltviw"}],["path",{d:"M3.103 6.034h17.794",key:"awc11p"}],["path",{d:"M3.4 5.467a2 2 0 0 0-.4 1.2V20a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2V6.667a2 2 0 0 0-.4-1.2l-2-2.667A2 2 0 0 0 17 2H7a2 2 0 0 0-1.6.8z",key:"o988cm"}]]);e.s(["ShoppingBag",()=>t],90294)},22368,e=>{"use strict";let t=(0,e.i(35884).default)("minus",[["path",{d:"M5 12h14",key:"1ays0h"}]]);e.s(["Minus",()=>t],22368)},52443,e=>{"use strict";let t=(0,e.i(35884).default)("arrow-right",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"m12 5 7 7-7 7",key:"xquz4c"}]]);e.s(["ArrowRight",()=>t],52443)},81119,e=>{"use strict";var t=e.i(48277),r=e.i(30668),s=e.i(16506),a=e.i(37770),l=e.i(49449),o=e.i(3333),i=e.i(22368),c=e.i(90294),d=e.i(52443),n=e.i(88255),u=e.i(59484),m=e.i(47281),p=e.i(40206),h=e.i(99738),x=e.i(22195),f=e.i(96086),g=e.i(35384);e.i(92544);var y=e.i(11897);function b(){return(0,t.jsx)(g.ClientErrorBoundary,{children:(0,t.jsx)(j,{})})}function j(){let{cart:e,cartCount:g,cartTotal:b,loading:j,removeFromCart:N,updateQuantity:v,clearCart:k}=(0,m.useCart)(),{user:w,isAuthenticated:C}=(0,p.useAuth)(),P=(0,f.useRouter)(),[S,M]=(0,r.useState)({street:"",building:"",room:""}),[F,A]=(0,r.useState)(!1),[B,_]=(0,r.useState)(!1);(0,r.useEffect)(()=>{C||P.push("/login?redirect=/buyer/cart")},[C,P]);let q=(0,r.useCallback)(async e=>{if(confirm("Remove this item from cart?"))try{await N(e),y.toast.success("Item removed from cart")}catch(e){console.error("Failed to remove item:",e),y.toast.error("Failed to remove item from cart."),y.toast.error("Failed to remove item")}},[N]),R=(0,r.useCallback)(async(e,t)=>{try{await v(e,t)}catch(e){console.error("Failed to update quantity:",e),y.toast.error("Failed to update quantity.")}},[v]),E=(0,r.useCallback)(async()=>{if(confirm("Clear all items from cart?"))try{await k(),y.toast.success("Cart cleared successfully")}catch(e){console.error("Failed to clear cart:",e),y.toast.error("Failed to clear cart."),y.toast.error("Failed to clear cart")}},[k]);(0,r.useCallback)(async(e,t)=>{try{let r=await x.ordersAPI.createOrder({productId:e,quantity:1,shippingAddress:t});P.push(`/buyer/orders/${r.data.order._id}`)}catch(e){console.error("Failed to checkout:",e),y.toast.error("Failed to proceed to checkout."),y.toast.error(e.response?.data?.message||"Failed to create order")}},[P]);let $=(0,r.useMemo)(()=>e.reduce((e,t)=>{let r=t.product.seller._id;return e[r]||(e[r]={sellerName:t.product.seller.name,items:[],total:0}),e[r].items.push(t),e[r].total+=t.product.price*t.quantity,e},{}),[e]),{sellerGroups:L,sellerCount:U}=(0,r.useMemo)(()=>{let e=Object.values($);return{sellerGroups:e,sellerCount:e.length}},[$]);(0,r.useMemo)(()=>new Set(e.map(e=>e.product.seller._id)).size,[e]);let T=(0,r.useCallback)(async()=>{if(0===e.length)return;if(!S.street||!S.building||!S.room){A(!0),y.toast.error("Please fill in your shipping address");return}let t=w?.phone||"";if(!t)return void y.toast.error("Please update your phone number in your profile",{action:{label:"Update Profile",onClick:()=>P.push("/profile")}});try{_(!0);let e=L.map(e=>`- ${e.sellerName}: ${(0,h.formatPrice)(e.total)} (${e.items.length} item(s))`).join("\n");if(!confirm(`You will be charged ${(0,h.formatPrice)(b)} for ${g} item(s) from ${U} seller(s).

Breakdown by seller:
${e}

Proceed with payment?`))return void _(!1);let r=await x.ordersAPI.checkoutCart({shippingAddress:S,phoneNumber:t,paymentMethod:"mpesa"});await k(),y.toast.success(`Checkout successful! ${r.data.orderCount} order(s) created. Please check your phone for M-Pesa prompt.`,{description:`Total: ${(0,h.formatPrice)(r.data.totalAmount)}`}),P.push(`/buyer/orders?session=${r.data.checkoutSessionId}`)}catch(e){console.error("Failed to checkout:",e),y.toast.error("Failed to proceed to checkout."),y.toast.error(e.response?.data?.message||"Checkout failed. Please try again."),y.toast.error(e.response?.data?.message||"Failed to checkout. Please try again.")}finally{_(!1)}},[e,g,b,S,w?.phone,L,U,k,P]);return(0,t.jsx)("div",{className:"container mx-auto px-4 py-8",children:(0,t.jsxs)("div",{className:"max-w-4xl mx-auto",children:[(0,t.jsxs)("div",{className:"flex items-center justify-between mb-8",children:[(0,t.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,t.jsx)(c.ShoppingBag,{className:"h-8 w-8 text-primary"}),(0,t.jsx)("h1",{className:"text-3xl font-bold",children:"Shopping Cart"}),g>0&&(0,t.jsxs)("span",{className:"px-3 py-1 rounded-full bg-primary text-primary-foreground text-sm",children:[g," ",1===g?"item":"items"]})]}),e.length>0&&(0,t.jsx)("button",{onClick:E,className:"text-sm text-destructive hover:underline",children:"Clear Cart"})]}),j?(0,t.jsxs)("div",{className:"text-center py-16",children:[(0,t.jsx)("div",{className:"animate-spin text-4xl",children:"â³"}),(0,t.jsx)("p",{className:"mt-4 text-muted-foreground",children:"Loading cart..."})]}):0===e.length?(0,t.jsxs)("div",{className:"text-center py-16",children:[(0,t.jsx)(c.ShoppingBag,{className:"h-24 w-24 mx-auto text-muted-foreground mb-4"}),(0,t.jsx)("h2",{className:"text-2xl font-semibold mb-2",children:"Your cart is empty"}),(0,t.jsx)("p",{className:"text-muted-foreground mb-6",children:"Add some items to get started!"}),(0,t.jsxs)(s.default,{href:"/products",className:"inline-flex items-center space-x-2 px-6 py-3 bg-primary text-primary-foreground rounded-lg hover:bg-primary/90 transition-colors",children:[(0,t.jsx)("span",{children:"Browse Products"}),(0,t.jsx)(d.ArrowRight,{className:"h-5 w-5"})]})]}):(0,t.jsxs)("div",{className:"space-y-6",children:[(0,t.jsx)("div",{className:"space-y-4",children:e.map(e=>(0,t.jsxs)("div",{className:"flex flex-col sm:flex-row gap-4 p-4 rounded-lg border bg-card",children:[(0,t.jsx)(s.default,{href:`/products/${e.product._id}`,className:"relative w-full sm:w-32 h-32 flex-shrink-0 rounded-lg overflow-hidden bg-muted",children:(0,t.jsx)(a.default,{src:e.product.images?.[0],alt:e.product.title,fill:!0})}),(0,t.jsxs)("div",{className:"flex-1 space-y-2",children:[(0,t.jsxs)("div",{className:"flex items-start justify-between",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)(s.default,{href:`/products/${e.product._id}`,className:"font-semibold hover:text-primary transition-colors",children:e.product.title}),(0,t.jsxs)("p",{className:"text-sm text-muted-foreground",children:["Seller: ",e.product.seller?.name]})]}),(0,t.jsx)("button",{onClick:()=>q(e.product._id),className:"p-2 text-destructive hover:bg-destructive/10 rounded-lg transition-colors",title:"Remove from cart",children:(0,t.jsx)(l.Trash2,{className:"h-5 w-5"})})]}),(0,t.jsxs)("div",{className:"flex items-center justify-between",children:[(0,t.jsx)("p",{className:"text-lg font-bold text-primary",children:(0,h.formatPrice)(e.product.price)}),(0,t.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,t.jsx)("button",{onClick:()=>R(e.product._id,Math.max(1,e.quantity-1)),className:"p-1 rounded border hover:bg-accent transition-colors",disabled:e.quantity<=1,children:(0,t.jsx)(i.Minus,{className:"h-4 w-4"})}),(0,t.jsx)("span",{className:"w-12 text-center font-medium",children:e.quantity}),(0,t.jsx)("button",{onClick:()=>R(e.product._id,e.quantity+1),className:"p-1 rounded border hover:bg-accent transition-colors",children:(0,t.jsx)(o.Plus,{className:"h-4 w-4"})})]})]}),(0,t.jsxs)("div",{className:"flex items-center justify-between pt-2 border-t",children:[(0,t.jsxs)("p",{className:"text-sm text-muted-foreground",children:["Subtotal:"," ",(0,t.jsx)("span",{className:"font-semibold text-foreground",children:(0,h.formatPrice)(e.product.price*e.quantity)})]}),(0,t.jsx)(s.default,{href:`/buyer/checkout?productId=${e.product._id}&quantity=${e.quantity}`,className:"px-4 py-2 bg-primary text-primary-foreground rounded-lg hover:bg-primary/90 transition-colors text-sm font-medium",children:"Buy Now"})]})]})]},e.product._id))}),F&&(0,t.jsxs)("div",{className:"rounded-lg border bg-card p-6",children:[(0,t.jsxs)("div",{className:"flex items-center space-x-2 mb-4",children:[(0,t.jsx)(n.MapPin,{className:"h-5 w-5 text-primary"}),(0,t.jsx)("h2",{className:"text-xl font-semibold",children:"Shipping Address"})]}),(0,t.jsxs)("div",{className:"space-y-4",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-sm font-medium mb-2",children:"Street/Hall Name *"}),(0,t.jsx)("input",{type:"text",value:S.street,onChange:e=>M({...S,street:e.target.value}),placeholder:"e.g., Main Street, Hostel A",className:"w-full px-4 py-2 rounded-lg border bg-background"})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-sm font-medium mb-2",children:"Building/Floor *"}),(0,t.jsx)("input",{type:"text",value:S.building,onChange:e=>M({...S,building:e.target.value}),placeholder:"e.g., Building 1, 2nd Floor",className:"w-full px-4 py-2 rounded-lg border bg-background"})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-sm font-medium mb-2",children:"Room Number *"}),(0,t.jsx)("input",{type:"text",value:S.room,onChange:e=>M({...S,room:e.target.value}),placeholder:"e.g., Room 123, 2B",className:"w-full px-4 py-2 rounded-lg border bg-background"})]})]})]}),(0,t.jsxs)("div",{className:"rounded-lg border bg-card p-6",children:[(0,t.jsx)("h2",{className:"text-xl font-semibold mb-4",children:"Order Summary"}),e.length>0&&(0,t.jsxs)("div",{className:"flex items-center space-x-2 mb-4 p-3 bg-blue-50 dark:bg-blue-950 rounded-lg",children:[(0,t.jsx)(u.Package,{className:"h-5 w-5 text-blue-600"}),(0,t.jsxs)("div",{className:"flex-1",children:[(0,t.jsxs)("p",{className:"text-sm font-medium",children:["Items from ",new Set(e.map(e=>e.product.seller._id)).size," seller(s)"]}),(0,t.jsx)("p",{className:"text-xs text-muted-foreground",children:"You'll receive one M-Pesa prompt for the total amount"})]})]}),(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsxs)("div",{className:"flex justify-between",children:[(0,t.jsx)("span",{className:"text-muted-foreground",children:"Subtotal"}),(0,t.jsx)("span",{className:"font-medium",children:(0,h.formatPrice)(b)})]}),(0,t.jsxs)("div",{className:"flex justify-between",children:[(0,t.jsx)("span",{className:"text-muted-foreground",children:"Shipping"}),(0,t.jsx)("span",{className:"font-medium",children:"Calculated at checkout"})]}),(0,t.jsx)("div",{className:"h-px bg-border my-2"}),(0,t.jsxs)("div",{className:"flex justify-between text-lg",children:[(0,t.jsx)("span",{className:"font-semibold",children:"Total"}),(0,t.jsx)("span",{className:"font-bold text-primary",children:(0,h.formatPrice)(b)})]})]}),(0,t.jsx)("button",{onClick:T,disabled:B||0===e.length,className:"w-full mt-6 px-6 py-3 bg-primary text-primary-foreground rounded-lg hover:bg-primary/90 transition-colors font-medium disabled:opacity-50 disabled:cursor-not-allowed",children:B?"Processing...":"Proceed to Checkout"}),(0,t.jsx)(s.default,{href:"/products",className:"block w-full mt-3 text-center text-sm text-muted-foreground hover:text-primary transition-colors",children:"Continue Shopping"})]})]})]})})}e.s(["default",()=>b])}]);